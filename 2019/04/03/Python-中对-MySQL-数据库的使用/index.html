<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-loading-bar.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.1.0" rel="stylesheet" type="text/css">



  <link rel="icon" type="image/png" sizes="32x32" href="/images/my_favicon.png?v=6.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/my_favicon.png?v=6.1.0">










<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="在日常开发过程中总是在所难免的会和数据库打交道。 在 Python 中对数据库（MySQL为例）的操作不外乎以下两种情况：  使用支持原生 SQL 语句的连接方式。 使用支持 ORM 框架的方式。">
<meta name="keywords" content="Python,MySQL">
<meta property="og:type" content="article">
<meta property="og:title" content="Python 中对 MySQL 数据库的使用">
<meta property="og:url" content="https://csniu.github.io/2019/04/03/Python-中对-MySQL-数据库的使用/index.html">
<meta property="og:site_name" content="李大宝的包子">
<meta property="og:description" content="在日常开发过程中总是在所难免的会和数据库打交道。 在 Python 中对数据库（MySQL为例）的操作不外乎以下两种情况：  使用支持原生 SQL 语句的连接方式。 使用支持 ORM 框架的方式。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-04-03T09:10:32.297Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Python 中对 MySQL 数据库的使用">
<meta name="twitter:description" content="在日常开发过程中总是在所难免的会和数据库打交道。 在 Python 中对数据库（MySQL为例）的操作不外乎以下两种情况：  使用支持原生 SQL 语句的连接方式。 使用支持 ORM 框架的方式。">






  <link rel="canonical" href="https://csniu.github.io/2019/04/03/Python-中对-MySQL-数据库的使用/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Python 中对 MySQL 数据库的使用 | 李大宝的包子</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-100475240-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-100475240-1');
</script>






  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <!--<a href="https://github.com/csniu" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>-->

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> 

<div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">李大宝的包子</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
          
  
  <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">12</span>
      </a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">6</span>
      </a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">9</span>
      </a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-commonweal">
    <a href="/404/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>公益 404</a>
</li>

      

      
    </ul>
  

  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://csniu.github.io/2019/04/03/Python-中对-MySQL-数据库的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="csniu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李大宝的包子">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Python 中对 MySQL 数据库的使用</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-03T16:56:10+08:00">2019-04-03</time>
            

            
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/工具/" itemprop="url" rel="index"><span itemprop="name">工具</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/04/03/Python-中对-MySQL-数据库的使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/04/03/Python-中对-MySQL-数据库的使用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>在日常开发过程中总是在所难免的会和数据库打交道。</p>
<p>在 Python 中对数据库（MySQL为例）的操作不外乎以下两种情况：</p>
<ul>
<li>使用支持原生 SQL 语句的连接方式。</li>
<li>使用支持 ORM 框架的方式。</li>
</ul>
<a id="more"></a>
<hr>
<h2 id="1-原生-SQL-语句"><a href="#1-原生-SQL-语句" class="headerlink" title="1.原生 SQL 语句"></a>1.原生 SQL 语句</h2><p>使用原生的 SQL 语句去操作数据库会更加的灵活可以，也比较轻量级。</p>
<p>这种方式的使用和在数据库的客户端执行 SQL 语句基本无差。</p>
<p>缺点就是要拼接 SQL 语句，代码会变得非常臃肿，也不利于后期的维护工作。当然安全性也是个问题。</p>
<p>一般流程：</p>
<blockquote>
<p>1.创建连接</p>
<p>2.获得游标</p>
<p>3.执行 SQL 语句（拼接 SQL 语句）</p>
<p>4.关闭游标和连接</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接数据库</span></span><br><span class="line">conn = pymysql.connect(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">3306</span>, user=<span class="string">'root'</span>, passwd=<span class="string">'123'</span>, db=<span class="string">'t1'</span>)</span><br><span class="line"><span class="comment"># 游标设置为字典类型</span></span><br><span class="line">cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)</span><br><span class="line"><span class="comment"># 执行语句</span></span><br><span class="line">r = cursor.execute(<span class="string">"call p1()"</span>)</span><br><span class="line"><span class="comment"># 获取结果</span></span><br><span class="line">result = cursor.fetchone()</span><br><span class="line"><span class="comment"># 提交和关闭连接</span></span><br><span class="line">conn.commit()</span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p>目前主要的 MySQL 驱动有如下几个：</p>
<ul>
<li><p>MySQL-python</p>
<p>又叫 MySQLdb，是最流行的一款，但是只支持 python2.x，而且安装还有很多的前置条件。</p>
<p>现在基本<strong>不推荐</strong>使用。</p>
</li>
<li><p>mysqlclient</p>
<p>由 MySQLdb 发展而来，完全兼容 MySQLdb 同时支持 python3.x 。</p>
<p>也是 Django ORM 的依赖工具。</p>
<p><strong>推荐</strong>使用。</p>
</li>
<li><p>PyMySQL</p>
<p>纯 python 实现的驱动，速度上自然是逊色一些。</p>
<p>优点是安装方便简单。</p>
</li>
</ul>
<hr>
<h2 id="2-ORM-框架"><a href="#2-ORM-框架" class="headerlink" title="2.ORM 框架"></a>2.ORM 框架</h2><p>在使用原生 SQL 时，对数据库的简单操作或者是低频次的使用时，是足够的。</p>
<p>但是如果项目比较繁琐需要频繁的对数据库进行操作，这个时候就会遇到一些问题，比如连接池，性能等等问题。</p>
<p>ORM 框架是建立在数据库 API 之上，使用关系对象映射进行数据操作。</p>
<p>简单理解就是：</p>
<ul>
<li>ORM 框架本身是没有操作数据库的能力，它依赖于一些支持原生 SQL 的工具包（如：mysqlclient）。</li>
<li>ORM 是对数据库的关系（表字段，表之间的对于关系等）做了抽象化的映射。</li>
<li>是注重使用层面的封装，解决了一些必要的问题。</li>
</ul>
<p>原理就是：把对类的操作转化为原生的 SQL 进行数据库操作。</p>
<p>缺点：会有一些性能上的损失。</p>
<p>一般流程：</p>
<blockquote>
<p>1.创建类。对数据库的映射关系。</p>
<p>2.操作类。转换成 SQL 语句，对数据库进行操作。</p>
</blockquote>
<p>Python 的 ORM 框架有很多，在网上能够搜到很多的介绍和比较，这里主要介绍 SQLAlchemy。</p>
<hr>
<h3 id="SQLAlchemy"><a href="#SQLAlchemy" class="headerlink" title="SQLAlchemy"></a>SQLAlchemy</h3><h4 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h4><p><code>pip3 install sqlalchemy</code></p>
<p>记得要安装底层的 MySQL API <code>pip3 install mysqlclient</code></p>
<h4 id="2-连接"><a href="#2-连接" class="headerlink" title="2.连接"></a>2.连接</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</span><br><span class="line">engine = create_engine(<span class="string">'mysql+pymysql://root:root@localhost/test?charset=utf8'</span>,echo=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>通过 <a href="https://docs.sqlalchemy.org/en/latest/core/engines.html#sqlalchemy.create_engine" target="_blank" rel="noopener">create_engine</a> 创建一个<a href="https://docs.sqlalchemy.org/en/latest/core/connections.html#sqlalchemy.engine.Engine" target="_blank" rel="noopener"><code>Engine</code></a>的实例。也是 SQLAlchemy 的核心接口。</li>
<li>创建 Engine 后并不会立即建立连接，而是会在第一次执行语句时才会真正的创建连接。</li>
<li>第一个参数是连接数据库的表单数据，格式如下：<ul>
<li><code>dialect[+driver]://user:password@host:port/dbname[?key=value..]</code><ul>
<li>dialect：数据库类型，如 MySql、oracle 等。</li>
<li>driver：数据库驱动名称，如 mysqlclient。MySQL默认的是MySQLdb。</li>
<li>user：用户名</li>
<li>password：用户密码</li>
<li>host：主机地址</li>
<li>port；端口号</li>
<li>dbname：需要绑定的数据库名。<strong>连接时必须绑定具体的数据库，这就现在了使用多数据库的情况。</strong></li>
<li>后面还可以指定一些其他的连接信息，如：charset=utf8</li>
</ul>
</li>
</ul>
</li>
<li>echo=True，表示启用 logging 记录底层的 SQL 语句。</li>
<li>还有很多的其他参数可设置，可查看文档。这些参数主要用于底层的连接池创建设置。</li>
</ul>
<h4 id="3-使用"><a href="#3-使用" class="headerlink" title="3.使用"></a>3.使用</h4><p>SQLALchemy 支持两种使用方式。</p>
<p>（1）：原生的 SQL 语句</p>
<p>（2）：ORM 对象映射</p>
<p>对数据库的操作一般也就是 增、删、改、查、事务 等。</p>
<h5 id="一、原生-SQL-方法"><a href="#一、原生-SQL-方法" class="headerlink" title="一、原生 SQL 方法"></a>一、原生 SQL 方法</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">conn = engine.connect()  <span class="comment"># 创建一个连接</span></span><br><span class="line">trans = connection.begin()  <span class="comment"># 开始一个事务</span></span><br><span class="line"></span><br><span class="line">rs = conn.execute(<span class="string">'SELECT 5'</span>)  <span class="comment"># 执行 SQL 语句，不需要游标也不需要 commit</span></span><br><span class="line">data = rs.fetchone()[<span class="number">0</span>]  <span class="comment"># 取回结果</span></span><br><span class="line"></span><br><span class="line">trans.commit()  <span class="comment"># 提交，对应于事务操作</span></span><br><span class="line">trans.rollback()  <span class="comment"># 回滚，事务</span></span><br><span class="line">conn.close()  <span class="comment"># 关闭连接，也可以使用 with 语句</span></span><br></pre></td></tr></table></figure>
<h5 id="二、对象映射方法"><a href="#二、对象映射方法" class="headerlink" title="二、对象映射方法"></a>二、对象映射方法</h5><h6 id="1-创建映射关系"><a href="#1-创建映射关系" class="headerlink" title="1.创建映射关系"></a>1.创建映射关系</h6><p>在 SQLAlchemy 中所有的数据模型都要继承于一个基类，而这个基类一般通过 <a href="https://docs.sqlalchemy.org/en/latest/orm/extensions/declarative/api.html#sqlalchemy.ext.declarative.declarative_base" target="_blank" rel="noopener"><code>declarative_base()</code></a>创建。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line">Base = declarative_base()</span><br></pre></td></tr></table></figure>
<p>现在基类已经有了，接下来就是定义数据模型（对应数据库中的一张表）了，如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> Column, Integer, String</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'users'</span>  <span class="comment"># 数据库的表名</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 字段</span></span><br><span class="line">    id = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String)</span><br><span class="line">    fullname = Column(String)</span><br><span class="line">    nickname = Column(String)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;User(name='%s', fullname='%s', nickname='%s')&gt;"</span> % (</span><br><span class="line">            self.name, self.fullname, self.nickname)</span><br></pre></td></tr></table></figure>
<ul>
<li>必须要定义的表名和主键，其他的和 Python 类无差别。</li>
<li><p><a href="https://docs.sqlalchemy.org/en/latest/core/type_basics.html?highlight=column%20type#generic-types" target="_blank" rel="noopener">支持的字段类型</a>，Column 的<a href="https://docs.sqlalchemy.org/en/latest/core/metadata.html?highlight=column%20autoincrement#sqlalchemy.schema.Column.__init__" target="_blank" rel="noopener">可选参数</a></p>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Base.metadata.create_all(engine)  # 自动创建所有不存在的表</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h6 id="2-创建会话"><a href="#2-创建会话" class="headerlink" title="2.创建会话"></a>2.创建会话</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line">Session = sessionmaker(bind=engine)  <span class="comment"># 根据 engine 创建会话类</span></span><br><span class="line">session = Session()</span><br></pre></td></tr></table></figure>
<ul>
<li>Session 就相当于连接池。</li>
<li>对数据库的操作，首先要拿到一个连接（Session 实例），对数据库的所有操作都要在这个连接中实现。</li>
<li>session 使用完要记得关闭。也可以使用 with 语句。</li>
<li>session 也具有一些类方法，可以查看当前会话的状态等。</li>
</ul>
<h6 id="3-增删改查操作"><a href="#3-增删改查操作" class="headerlink" title="3.增删改查操作"></a>3.增删改查操作</h6><p>增：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ed_user = User(name=<span class="string">'ed'</span>, fullname=<span class="string">'Ed Jones'</span>, nickname=<span class="string">'edsnickname'</span>)</span><br><span class="line">session.add(ed_user)  <span class="comment"># 如果数据已经存在会报错</span></span><br><span class="line"><span class="comment"># session.add_all()  # 同时添加多条</span></span><br><span class="line">session.commit()</span><br></pre></td></tr></table></figure>
<p>查：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user = session.query(User)  <span class="comment"># 返回查询结果集，支持 get、切片、过滤、排序、分组等操作。</span></span><br><span class="line">users = db.session.query(User).join(Role, Role.id == User.role_id)  <span class="comment"># 连表</span></span><br></pre></td></tr></table></figure>
<p><a href="https://docs.sqlalchemy.org/en/latest/orm/tutorial.html#querying" target="_blank" rel="noopener">参考文档</a></p>
<p>改：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user.name = <span class="string">'lfjfl'</span>  <span class="comment"># 直接赋值</span></span><br><span class="line">session.commit()</span><br><span class="line"></span><br><span class="line">session.query(Role).filter(Role.id == <span class="number">1</span>).update(&#123;<span class="string">'name'</span>: <span class="string">'admin'</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>删：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user.delete()</span><br><span class="line">session.commit()</span><br></pre></td></tr></table></figure>
<p>事务：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.rollback()</span><br></pre></td></tr></table></figure>
<p><strong><em>这些只是简单的例子，还有很多的方法可以使用。可以查看官方文档。</em></strong></p>
<hr>
<h3 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h3><p>1.在使用过程中一般有两个情况：（1）代码优先。（2）数据库优先</p>
<ul>
<li><p>代码优先：通过编写代码动态的创建数据库。需要考虑数据的迁移问题(alembic )。</p>
</li>
<li><p>数据库优先：一般数据库已经创建好了，再去编写 Model 就很繁琐。这个时候可以通过一些工具直接从数据库生成 Model。（如 sqlacodegen ）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install sqlacodegen</span><br><span class="line">sqlacodegen mysql+pymysql://root:<span class="number">123456</span>@<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">3306</span>/mystock &gt; models.py</span><br><span class="line"><span class="comment"># 有主键的会生成一个类（Model），没有主键会生成一个表（Table）</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>2.也不是只有只有这两种方法，条条大路通罗马。</p>
<ul>
<li>ORM 框架主要是解决了连接池的问题，我们也可以通过 <a href="https://commons.apache.org/proper/commons-dbutils/" target="_blank" rel="noopener">DBUtils</a> 解决这个问题。</li>
</ul>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>SQLAlchemy 官方文档：<a href="https://docs.sqlalchemy.org/en/latest/index.html" target="_blank" rel="noopener">https://docs.sqlalchemy.org/en/latest/index.html</a></p>
<p>alembic 官方文档：<a href="https://alembic.sqlalchemy.org/en/latest/" target="_blank" rel="noopener">https://alembic.sqlalchemy.org/en/latest/</a></p>
<p>sqlacodegen ：<a href="https://pypi.org/project/sqlacodegen/" target="_blank" rel="noopener">https://pypi.org/project/sqlacodegen/</a></p>

      
    </div>

    

    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>csniu</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://csniu.github.io/2019/04/03/Python-中对-MySQL-数据库的使用/" title="Python 中对 MySQL 数据库的使用">https://csniu.github.io/2019/04/03/Python-中对-MySQL-数据库的使用/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Python/" rel="tag"># Python</a>
          
            <a href="/tags/MySQL/" rel="tag"># MySQL</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/01/个人博客搭建/" rel="next" title="Blog Hexo">
                <i class="fa fa-chevron-left"></i> Blog Hexo
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/05/11/RabbitMQ/" rel="prev" title="RabbitMQ">
                RabbitMQ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/my_avatar.jpg" alt="csniu">
            
              <p class="site-author-name" itemprop="name">csniu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/csniu" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:csniulv@aliyun.com" target="_blank" title="E-Mail" rel="external nofollow"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-原生-SQL-语句"><span class="nav-number">1.</span> <span class="nav-text">1.原生 SQL 语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-ORM-框架"><span class="nav-number">2.</span> <span class="nav-text">2.ORM 框架</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SQLAlchemy"><span class="nav-number">2.1.</span> <span class="nav-text">SQLAlchemy</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-安装"><span class="nav-number">2.1.1.</span> <span class="nav-text">1.安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-连接"><span class="nav-number">2.1.2.</span> <span class="nav-text">2.连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-使用"><span class="nav-number">2.1.3.</span> <span class="nav-text">3.使用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#一、原生-SQL-方法"><span class="nav-number">2.1.3.1.</span> <span class="nav-text">一、原生 SQL 方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#二、对象映射方法"><span class="nav-number">2.1.3.2.</span> <span class="nav-text">二、对象映射方法</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-创建映射关系"><span class="nav-number">2.1.3.2.1.</span> <span class="nav-text">1.创建映射关系</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-创建会话"><span class="nav-number">2.1.3.2.2.</span> <span class="nav-text">2.创建会话</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3-增删改查操作"><span class="nav-number">2.1.3.2.3.</span> <span class="nav-text">3.增删改查操作</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其他问题"><span class="nav-number">2.2.</span> <span class="nav-text">其他问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考"><span class="nav-number">2.3.</span> <span class="nav-text">参考</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">csniu</span>

  

  
</div>


  



  <div class="powered-by">由 <a class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" rel="external nofollow" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a> v6.1.0</div>




        








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  











  



  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/reading_progress/reading_progress.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.1.0"></script>



  

  
    <script id="dsq-count-scr" src="https://csniu.disqus.com/count.js" async></script>
  

  
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'https://csniu.github.io/2019/04/03/Python-中对-MySQL-数据库的使用/';
        this.page.identifier = '2019/04/03/Python-中对-MySQL-数据库的使用/';
        this.page.title = 'Python 中对 MySQL 数据库的使用';
      };
      function loadComments () {
        var d = document, s = d.createElement('script');
        s.src = 'https://csniu.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      }
      
        $(function () {
          var offsetTop = $('#comments').offset().top - $(window).height();
          if (offsetTop <= 0) {
            // load directly when there's no a scrollbar
            loadComments();
          } else {
            $(window).on('scroll.disqus_scroll', function () {
              var scrollTop = document.documentElement.scrollTop;
              if (scrollTop >= offsetTop) {
                $(window).off('.disqus_scroll');
                loadComments();
              }
            });
          }
        });
      
    </script>
  





	





  












  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  

  

  

  

  
  
  
  <script src="/lib/bookmark/bookmark.min.js?v=1.0"></script>
  <script type="text/javascript">
  
    bookmark.scrollToMark('auto', "#more");
  
  </script>


</body>
</html>
