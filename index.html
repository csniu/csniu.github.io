<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-loading-bar.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.1.0" rel="stylesheet" type="text/css">



  <link rel="icon" type="image/png" sizes="32x32" href="/images/my_favicon.png?v=6.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/my_favicon.png?v=6.1.0">










<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="python 学习笔记！">
<meta property="og:type" content="website">
<meta property="og:title" content="李大宝的包子">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="李大宝的包子">
<meta property="og:description" content="python 学习笔记！">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="李大宝的包子">
<meta name="twitter:description" content="python 学习笔记！">






  <link rel="canonical" href="http://yoursite.com/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>李大宝的包子</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-100475240-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-100475240-1');
</script>






  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <!--<a href="https://github.com/csniu" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>-->

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> 

<div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">李大宝的包子</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
          
  
  <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">0</span>
      </a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">1</span>
      </a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">8</span>
      </a>
</li>

      

      
    </ul>
  

  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/01/Blog-Hexo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="csniu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李大宝的包子">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/01/Blog-Hexo/" itemprop="url">Blog Hexo</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-01T16:51:03+08:00">2019-04-01</time>
            

            
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Develop/" itemprop="url" rel="index"><span itemprop="name">Develop</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Blog"><a href="#Blog" class="headerlink" title="Blog"></a>Blog</h2><p>搭建个人博客因该是很多的需要，尤其是程序员！</p>
<p>但是怎么搭建，搭建成什么样的每个人都会有不同的选择。</p>
<p>根据实现的技术大致有以下几种方案：</p>
<ul>
<li><p>个人主页</p>
<p>有很多的平台都可以注册。优缺点就不言而喻了。</p>
</li>
<li><p>静态网站生成技术</p>
<p>这个就有一些技术门槛了，要有一些计算机的基础才行了。基本原理就是通过编写一些静态文件（Markdown），再通过编译器自动编译成展示的页面。主流的有 hexo、hugo、jekyll等。</p>
<p>优点：操作简单、足够定制化。</p>
<p>缺点：有一定的技术门槛，是静态的。（动态的部分要通过第三方实现）</p>
</li>
<li><p>内容管理系统</p>
<p>这种技术要求就更高了，要涉及到服务器、数据库、域名等等。也就是建站了。如 Wordpress 等</p>
<p>缺点：技术要求高、维护成本高。</p>
<p>优点：完全定制化。</p>
</li>
</ul>
<p># 更加详细的比较请参考<a href="https://segmentfault.com/a/1190000011661576" target="_blank" rel="noopener">这里</a>。</p>
<h2 id="Hexo"><a href="#Hexo" class="headerlink" title="Hexo"></a>Hexo</h2><p><strong><em>说在前面，本机环境 window10， 64-bit，命令行操作默认是在 Git Bash 下除非特别说明。</em></strong></p>
<h3 id="基础篇"><a href="#基础篇" class="headerlink" title="基础篇"></a>基础篇</h3><hr>
<h4 id="一、搭建环境"><a href="#一、搭建环境" class="headerlink" title="一、搭建环境"></a>一、搭建环境</h4><ul>
<li><p>安装 Git</p>
</li>
<li><p>安装 Node.js</p>
<ul>
<li>下载地址：<a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">https://nodejs.org/en/download/</a></li>
<li>默认会添加到环境变量中好安装 npm。</li>
<li>测试：<code>node -v</code> 、 <code>npm -v</code></li>
</ul>
</li>
<li><p>安装 Hexo</p>
<ul>
<li><code>npm install -g hexo-cli</code></li>
<li>测试：<code>hexo -v</code></li>
</ul>
</li>
</ul>
<h4 id="二、初始化"><a href="#二、初始化" class="headerlink" title="二、初始化"></a>二、初始化</h4><ul>
<li><p>创建项目文件夹</p>
<ul>
<li><code>mkdir myblog</code></li>
</ul>
</li>
<li><p>初始化</p>
<ul>
<li><code>hexo init myblog</code></li>
<li>会自动在 myblog 文件夹中生成必要的文件。</li>
</ul>
</li>
<li><p>目录介绍</p>
<ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── _config.yml</span><br><span class="line">├── package.json</span><br><span class="line">├── scaffolds</span><br><span class="line">├── source</span><br><span class="line">|   ├── _drafts</span><br><span class="line">|   └── _posts</span><br><span class="line">└── themes</span><br></pre></td></tr></table></figure>
<blockquote>
<p>_config.yml：配置文件</p>
<p>packge.json：应用程序的信息</p>
<p>scaffolds：模板文件夹</p>
<p>source：资源文件夹</p>
<p>themex：主题文件夹</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h4 id="三、配置"><a href="#三、配置" class="headerlink" title="三、配置"></a>三、配置</h4><p>网站的大部分配置都可以在 _config.yml 中设置。</p>
<p>详细介绍请移步<a href="https://hexo.io/zh-cn/docs/configuration" target="_blank" rel="noopener">官方文档</a>，这里就不过多介绍。</p>
<h4 id="四、小试牛刀"><a href="#四、小试牛刀" class="headerlink" title="四、小试牛刀"></a>四、小试牛刀</h4><p>运行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo new test_my_site  <span class="comment"># 新建一篇文章</span></span><br><span class="line">hexo g  <span class="comment"># 解析成 Html 文件</span></span><br><span class="line">hexo s  <span class="comment"># 启动服务器</span></span><br></pre></td></tr></table></figure>
<p>这个时候打开浏览器访问：<a href="http://localhost:4000/" target="_blank" rel="noopener">http://localhost:4000/</a>  ，就能看到你博客了。</p>
<blockquote>
<p>会生成 db.json 和 public 文件夹</p>
<p>db.json: 缓存文件</p>
<p>public：生成的静态文件地址（Html 等前文件，真正展示的网页文件）</p>
</blockquote>
<h4 id="五、运行原理及流程"><a href="#五、运行原理及流程" class="headerlink" title="五、运行原理及流程"></a>五、运行原理及流程</h4><p>操作流程一般是：1.创建 md 文件。2.渲染成 html 文件。3.发布</p>
<p><strong>1.</strong>  <code>hexo new [layout] &lt;title&gt;</code></p>
<blockquote>
<ul>
<li><p>默认使用配置文件中的：<code>default_layout</code> </p>
</li>
<li><p>首先根据 layout 参数到 scaffolsd 文件夹下查找对应的模板文件。</p>
</li>
<li><p>layout 参数主要用来查找模板得到 Front-matter，和判断文件要保存的位置</p>
</li>
<li><p>Front-matter，如下</p>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;   </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<blockquote>
<hr>
<blockquote>
<p>title: Hello World</p>
<h2 id="date-2013-7-13-20-46-25"><a href="#date-2013-7-13-20-46-25" class="headerlink" title="date: 2013/7/13 20:46:25"></a>date: 2013/7/13 20:46:25</h2></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;  - 记录一些必要信息，标题、时间、分类、标签等，详细参数[参见文档](https://hexo.io/zh-cn/docs/front-matter)</span><br><span class="line">&gt; - hexo 提供了三种默认的布局：post(一篇文字)、page（一个文件夹）、draft。保存地址如下：</span><br><span class="line">&gt;  - post: source/_posts</span><br><span class="line">&gt;  - page: source</span><br><span class="line">&gt;  - draft: source/_drafts</span><br><span class="line">&gt;  - 其他所有的布局都和 post 一样。</span><br><span class="line">&gt;  - 创建一个 page 就是对应一个导航地址（如 home， tags 等）</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ul>
<li>创建 md 文件</li>
<li>默认以“标题 ”为文件名。</li>
<li>更改 new_post_name ，修改文件名规则，如  <code>:year-:month-:day-:title.md</code></li>
</ul>
</blockquote>
<p><strong>2.</strong> <code>hexo generate</code></p>
<blockquote>
<ul>
<li>查找文件<ul>
<li>忽略 source 下所有以 “_”开头的文件/文件夹，除了 _port</li>
<li>md 文件将被解析，其他文件会被直接拷贝</li>
</ul>
</li>
<li>解析 md 文件。<ul>
<li>根据当前的主题和一定的解析规则，将 md 文件解析成 html 文件用于展示。</li>
<li>解析的文件和拷贝的文件被保存在 public 中。</li>
</ul>
</li>
</ul>
</blockquote>
<p><strong>3.</strong> <code>hexo deploy</code></p>
<blockquote>
<ul>
<li>就是将 public 文件夹下的文件推送到远端。</li>
<li>其他文件并不会被推送。</li>
</ul>
</blockquote>
<h3 id="主题篇"><a href="#主题篇" class="headerlink" title="主题篇"></a>主题篇</h3><hr>
<h4 id="一、命令"><a href="#一、命令" class="headerlink" title="一、命令"></a>一、命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">hexo -help</span><br><span class="line"></span><br><span class="line">hexo init [folder]  # 初始化，可指定文件夹，默认当前路径</span><br><span class="line"></span><br><span class="line">hexo new [layout] &lt;title&gt;  # 新建一片文章，可指定 layout,默认使用配置文件中的默认值</span><br><span class="line"></span><br><span class="line">hexo generate # 生成静态文件，可选参数 -d(--deploy):生成后立即部署，-w(--watch):监视文件变化</span><br><span class="line"></span><br><span class="line">hexo publish [layout] &lt;filename&gt;  # 发表草稿</span><br><span class="line"></span><br><span class="line">hexo server # 启动服务器，默认 4000端口。可选参数：-p(--port):端口号，-s(--static):只使用静态文件，-l(--log):启动日志记录；-i：指定ip地址</span><br><span class="line"></span><br><span class="line">hexo deploy  # 部署，可选 -g(--generate):部署之前生成静态文件</span><br><span class="line"></span><br><span class="line">hexo render &lt;file1&gt; [file2] ...  # 渲染文件，可选 -o(--output):输出路径</span><br><span class="line"></span><br><span class="line">hexo migrate &lt;type&gt;  # 从其他博客系统迁移内容</span><br><span class="line"></span><br><span class="line">hexo clean  # 清除缓存文件（db.json）和已生成的静态文件（public）</span><br><span class="line"></span><br><span class="line">hexo list  </span><br><span class="line"></span><br><span class="line">hexo version</span><br><span class="line"></span><br><span class="line"># 以上命令都有以下可选参数</span><br><span class="line">hexo --safe  # 安全模式，不使用插件和脚本</span><br><span class="line">hexo --debug  # 调试模式，在终端和debug.log 中记录日志</span><br><span class="line">hexo --config custom.yml  # 自定义配置文件路径</span><br><span class="line">hexo --draft  # 显示草稿。（source/_drafts）</span><br><span class="line">hexo --cwd /path/to  # 自定义当前工作路径</span><br></pre></td></tr></table></figure>
<p># generate 简写 g；deploy–d;watch–w;</p>
<h4 id="二、部署到远端服务器"><a href="#二、部署到远端服务器" class="headerlink" title="二、部署到远端服务器"></a>二、部署到远端服务器</h4><p>在基础篇中都是部署在本地的，建博客当然是要让更多人看到我们的文章了，明显在本地是不行的。</p>
<p>hexo 提供了一键部署的功能 <code>hexo deploy</code>。</p>
<p>但是在云溪运行前要现在配置文件在配置好远端的信息才性。</p>
<p>以下以配置git 的远程仓库为例（如 gitbub）:</p>
<p>安装部署git插件：<code>npm install hexo-deployer-git --save</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: &lt;repository url&gt; #https://bitbucket.org/JohnSmith/johnsmith.bitbucket.io.git</span><br><span class="line">  branch: [branch] #published</span><br><span class="line">  message: [message]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>type:  类型，当然不止 git 一种了</p>
<p>repo：远端仓库地址</p>
<p>branch：分支，使用 gitbub 时系统会自动检测</p>
<p>massage：提交信息</p>
</blockquote>
<p><strong>也可以同时配置多个远端。</strong></p>
<p><strong>更直接的把 public 文件夹直接拷贝走。</strong></p>
<h4 id="三、主题"><a href="#三、主题" class="headerlink" title="三、主题"></a>三、主题</h4><h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><ul>
<li>所有主题都存放在根目录下的 themes 下。</li>
<li>下载主题：<code>git clone https://github.com/iissnan/hexo-theme-next.git（主题的地址）</code></li>
<li>官方主题列表：<a href="https://hexo.io/themes/" target="_blank" rel="noopener">https://hexo.io/themes/</a></li>
<li>一个主题就 themes 下的一个文件夹，一般结构如下：<ul>
<li>_config.yml：主题配置文件</li>
<li>languages：语言文件</li>
<li>layout：布局文件，存放主题的模板文件。决定网页的呈现方式。本质就是带变量的 html 文件，一般包括如下<ul>
<li>index: 首页</li>
<li>post：文章详情页</li>
<li>page：导航标签页</li>
<li>archive：归档页</li>
<li>category：类别页</li>
<li>tag：标签页</li>
<li>layout：网页的整个布局，动态的由以上文件组成</li>
</ul>
</li>
<li>scripts：脚本文件夹</li>
<li>source：资源文件夹</li>
</ul>
</li>
</ul>
<h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><ul>
<li>配置配置文件中的theme字段信息即可</li>
</ul>
<h4 id="四、异步问题"><a href="#四、异步问题" class="headerlink" title="四、异步问题"></a>四、异步问题</h4><ul>
<li><p>本地是配置好了，可以写作发布。但是如果回到家使用其他电脑要怎么办昵？</p>
<ul>
<li>办法一：正常编写，但不发布。</li>
<li>办法二：创建一个相同的开发环境。部署到远端只是把 public 推送到了远端，替他必要的文件并没有推送，这就需要其他的方法备份其他文件，从而达到复制环境的目的了。</li>
</ul>
</li>
</ul>
<h4 id="五、其他"><a href="#五、其他" class="headerlink" title="五、其他"></a>五、其他</h4><ul>
<li>在实际使用中每个人都有一些不同的个性化需求。如 评论系统 等。</li>
<li>遇到想要的功能 Google 一下基本都会有的。</li>
<li>我的学习 hexo 的原则就是理解其运行原理即可，不懂的、想用的可以自行 Google。太深入的问题就没有必要去深究了。否则就违背了初衷。</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="noopener">官方文档</a>，更加详细的介绍。</p>
<p><a href="https://www.jianshu.com/p/5a1e6d8c83af" target="_blank" rel="noopener">站点布局的原理</a>。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/26/Pyhon-MySQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="csniu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李大宝的包子">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/26/Pyhon-MySQL/" itemprop="url">Pyhon MySQL</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-26T12:48:35+08:00">2019-03-26</time>
            

            
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Develop/" itemprop="url" rel="index"><span itemprop="name">Develop</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Python-MySQL"><a href="#Python-MySQL" class="headerlink" title="Python-MySQL"></a>Python-MySQL</h2><p>在日常脚本中操作数据库一般存在以下两种情况：</p>
<ul>
<li>使用支持原生 SQL 语句的连接方式。</li>
<li>使用支持 ORM 框架的方式。</li>
</ul>
<h4 id="1-原生-SQL"><a href="#1-原生-SQL" class="headerlink" title="1.原生 SQL"></a>1.原生 SQL</h4><p>使用原生的 SQL 语句去操作数据库会更加的灵活可以，也比较轻量级。</p>
<p>和在数据库的客户端执行 SQL 基本无差。</p>
<p>一般流程：</p>
<blockquote>
<p>1.创建连接</p>
<p>2.获得游标</p>
<p>3.执行 SQL 语句（拼接 SQL 语句）</p>
<p>4.关闭游标和连接</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">  </span><br><span class="line">conn = pymysql.connect(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">3306</span>, user=<span class="string">'root'</span>, passwd=<span class="string">'123'</span>, db=<span class="string">'t1'</span>)</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 游标设置为字典类型</span></span><br><span class="line">cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)</span><br><span class="line">r = cursor.execute(<span class="string">"call p1()"</span>)</span><br><span class="line">  </span><br><span class="line">result = cursor.fetchone()</span><br><span class="line">  </span><br><span class="line">conn.commit()</span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p>目前主要的 MySQL 驱动有如下几个：</p>
<ul>
<li><p>MySQL-python</p>
<p>又叫 MySQLdb，是最流行的一款，但是只支持 python2.x，而且安装还有很多的前置条件。</p>
<p>现在基本<strong>不推荐</strong>使用。</p>
</li>
<li><p>mysqlclient</p>
<p>由 MySQLdb 发展而来，完全兼容 MySQLdb 同时支持 python3.x 。</p>
<p>也是 Django ORM 的依赖工具。</p>
<p><strong>推荐</strong>使用。</p>
</li>
<li><p>PyMySQL</p>
<p>纯 python 实现的驱动，速度上自然是逊色一些。</p>
<p>优点是安装方便简单。</p>
</li>
</ul>
<h4 id="2-ORM-框架"><a href="#2-ORM-框架" class="headerlink" title="2.ORM 框架"></a>2.ORM 框架</h4><p>在使用原生 SQL 时，对于简单的数据库操作或者是不底频次的操作时，是一种很简单方便的方式。</p>
<p>但是如果项目比较繁琐需要频繁的对数据库进行操作，这个时候就会遇到一些问题，比如连接池的问题，性能的问题等等。</p>
<p>ORM 框架是建立在数据库 API 之上，使用关系对象映射进行数据操作。</p>
<p>简单理解就是：</p>
<ul>
<li>ORM 框架本身是没有操作数据库的能力，依赖于一些支持原生 SQL 的工具包（如：mysqlclient）。</li>
<li>ORM 是对数据库的关系（表字段，表之间的对于关系等）做了抽象化的映射。（类，面向对象）</li>
<li>是对一些支持原生 SQL 的工具包的封装和优化，解决了一些常见的问题。</li>
</ul>
<p>原理就是：把对类的操作转化为原生的 SQL 进行数据库操作。</p>
<p>缺点：会有一些性能上的损失。</p>
<p>一般流程：</p>
<blockquote>
<p>1.创建类。</p>
<p>2.操作类。</p>
</blockquote>
<p>常见的框架有：</p>
<ul>
<li><p>peewee</p>
<p>python 最流行的 ORM 框架。</p>
</li>
<li><p>SQLALchemy</p>
<p>既支持原生 SQL，又支持 ORM 的工具</p>
<p><strong>常用</strong></p>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/14/Python-日志/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="csniu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李大宝的包子">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/14/Python-日志/" itemprop="url">Python 日志</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-14T10:00:56+08:00">2019-03-14</time>
            

            
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Develop/" itemprop="url" rel="index"><span itemprop="name">Develop</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Python-logging"><a href="#Python-logging" class="headerlink" title="Python-logging"></a>Python-logging</h2><p>python 的标准库包。提供了日志记录的 API。</p>
<p>包结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">logging\</span><br><span class="line">	| __init__.py  # 包入口，主要模块，定义了 logger、handler、formatter、filter 等类。</span><br><span class="line">	| config.py  # 定义了 配置函数以及读取配置文件的类。</span><br><span class="line">	| handlers.py  # 对 handler 的扩展完善。</span><br></pre></td></tr></table></figure>
<p>基本概念：</p>
<blockquote>
<p>1.Logger：日志的系统入口。</p>
<p>2.Handler：将日志记录（logger 创建）发送到指定的目标。</p>
<p>3.Filter：过滤日志。</p>
<p>4.Formatter：设置日志的格式。</p>
</blockquote>
<p>关系：</p>
<blockquote>
<ul>
<li>一个程序可以有多个 Logger 对象。（多个入口）（层级关系）</li>
<li>一个 Logger 对应多个 Handler。（输入到多个地方）</li>
<li>一个 Logger 对应多个 Filter。（多个过滤器）</li>
<li>一个 Handler 对应一个 Formatter。（输出格式）</li>
</ul>
</blockquote>
<h4 id="一、Logger"><a href="#一、Logger" class="headerlink" title="一、Logger"></a>一、Logger</h4><hr>
<p>提供应用程序可以直接使用的接口。要自行实例化后才可以使用。</p>
<h5 id="1-实例化"><a href="#1-实例化" class="headerlink" title="1.实例化"></a>1.实例化</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log = logging.getLogger(name)</span><br></pre></td></tr></table></figure>
<p># 使用相同的 “name” 实例化，会始终返回同一个 Logger 对象。</p>
<p># 如果没有自定，将换回 root logger。</p>
<p># “name” 可以是句点分割的层次值。类是于 python 包层次结构。<strong>推荐</strong>使用 <code>logging.getLogger(__name__)</code>.</p>
<blockquote>
<p>如包test结构如下：（需要 python 把test认定为一个包才行。）</p>
<p>test\</p>
<p>​    |t1.py</p>
<p>​    |t2.py</p>
<p>t2 中：<code>logging.getLogger(__name__)</code> 就等于 <code>logging.getLogger(test.t2)</code></p>
</blockquote>
<h5 id="2-配置"><a href="#2-配置" class="headerlink" title="2.配置"></a>2.配置</h5><p>方法1：</p>
<blockquote>
<p>使用Python代码显式的创建loggers, handlers和formatters并分别调用它们的配置函数；</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>logger.setLevel(logging.INFO)</td>
<td>指定最低的日志级别，默认为Warning。低于lel的级别将被忽略。debug是最低的内置级别，critical为最高</td>
</tr>
<tr>
<td>Logger.addHandler(hdlr)</td>
<td>增加指定的handler</td>
</tr>
<tr>
<td>Logger.removeHandler(hdlr)</td>
<td>删除指定的handler</td>
</tr>
<tr>
<td>Logger.addFilter(filt)</td>
<td>添加指定的filter</td>
</tr>
<tr>
<td>Logger.removeFilter(filt)</td>
<td>删除指定的filter</td>
</tr>
<tr>
<td>等等</td>
</tr>
</tbody>
</table>
<p># 日志级别：logging.DEBUG&lt;logging.INFO&lt;logging.WARNING&lt;logging.ERROR&lt;logging.CRITICAL</p>
<p>如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">import</span> logging</span><br><span class="line">&gt; <span class="keyword">import</span> sys</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="comment"># 创建一个日志器logger并设置其日志级别为DEBUG</span></span><br><span class="line">&gt; logger = logging.getLogger(<span class="string">'simple_logger'</span>)</span><br><span class="line">&gt; logger.setLevel(logging.DEBUG)</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="comment"># 创建一个流处理器handler并设置其日志级别为DEBUG</span></span><br><span class="line">&gt; handler = logging.StreamHandler(sys.stdout)</span><br><span class="line">&gt; handler.setLevel(logging.DEBUG)</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="comment"># 创建一个格式器formatter并将其添加到处理器handler</span></span><br><span class="line">&gt; formatter = logging.Formatter(<span class="string">"%(asctime)s - %(name)s - %(levelname)s - %(message)s"</span>)</span><br><span class="line">&gt; handler.setFormatter(formatter)</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="comment"># 为日志器logger添加上面创建的处理器handler</span></span><br><span class="line">&gt; logger.addHandler(handler)</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="comment"># 日志输出</span></span><br><span class="line">&gt; logger.debug(<span class="string">'debug message'</span>)</span><br><span class="line">&gt; logger.info(<span class="string">'info message'</span>)</span><br><span class="line">&gt; logger.warn(<span class="string">'warn message'</span>)</span><br><span class="line">&gt; logger.error(<span class="string">'error message'</span>)</span><br><span class="line">&gt; logger.critical(<span class="string">'critical message'</span>)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; 2019-02-26 09:44:43,982 - simple_logger - DEBUG - debug message</span><br><span class="line">&gt; 2019-02-26 09:44:44,000 - simple_logger - INFO - info message</span><br><span class="line">&gt; 2019-02-26 09:44:44,001 - simple_logger - WARNING - warn message</span><br><span class="line">&gt; 2019-02-26 09:44:44,001 - simple_logger - ERROR - error message</span><br><span class="line">&gt; 2019-02-26 09:44:44,001 - simple_logger - CRITICAL - critical message</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ul>
<li><code>basicConfig()</code> 也是这一类配置方法。主要是封装了配置代码，经行<strong>简单基本快捷</strong>的配置。</li>
</ul>
<p># 如果 root logger 已经有 handlers 配置，则不会经行任何配置。</p>
<p># 默认是创建一个 StreamHandler 到 <code>sys.stderr</code>并通过<code>BASIC_FORMAT</code>格式输出。</p>
<p># 也可以指定一些参数，改变默认配置。详见源代码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">import</span> logging</span><br><span class="line">&gt; </span><br><span class="line">&gt; logging.basicConfig()</span><br><span class="line">&gt; <span class="comment"># 自定义</span></span><br><span class="line">&gt; <span class="comment"># logging.basicConfig(level=logging.WARNING, format='%(asctime)s - %(filename)s[line:%(lineno)d] - %(levelname)s: %(message)s')</span></span><br><span class="line">&gt; </span><br><span class="line">&gt; logger = logging.getLogfig()</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="comment"># 日志输出</span></span><br><span class="line">&gt; logger.debug(<span class="string">'debug message'</span>)</span><br><span class="line">&gt; logger.info(<span class="string">'info message'</span>)</span><br><span class="line">&gt; logger.warn(<span class="string">'warn message'</span>)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; WARNING:root:warn message</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p># 只有高于 WARNING 的级别才会输出。</p>
</blockquote>
<p><strong>方法2：</strong></p>
<blockquote>
<p><strong>通过配置文件配置。</strong></p>
<ul>
<li>读取配置文件，主要是通过 <code>logging.config</code>模块中的<code>fileConfig</code>和<code>dictConfig()</code>方法实现。</li>
<li>fileConfig 本质是对 configparser 的封装。读取的 “file”。</li>
<li>dictConfig 中从配置字典中读取信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="function"><span class="keyword">def</span> <span class="title">fileConfig</span><span class="params">(fname, defaults=None, disable_existing_loggers=True)</span>:</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p># fname：配置文件。</p>
<p># defaults：传给 ConfigParser 的默认值。</p>
<p># 布尔值。默认为 True。表示禁用已经存在的 logger。</p>
<p><strong>配置文件格式。</strong></p>
<ul>
<li>因为 fileConfig 是对 ConfigParser 的封装，所有 fileConfig 能够理解的格式也是基于 ConfigParser 格式的，只是在其基础上对 <code>section</code>和 <code>option</code>进行了一些规定和现在。如下：</li>
</ul>
<blockquote>
<ul>
<li>配置文件<strong>必须</strong>配置的 section 包含 <code>loggers</code>、<code>handlers</code>、<code>formatters</code>。</li>
<li>通过 keys(option)来自定已经配置好的 <code>logger</code>、<code>handler</code>、<code>formatter</code>，多个用逗号分割。</li>
<li>并且 loggers 的 keys 中<strong>必须</strong>要有 root。</li>
</ul>
</blockquote>
<p>logger:</p>
<blockquote>
<ul>
<li>每一个 logger、handler、formatter 都<strong>必须</strong>在一个单独的 section 中定义。</li>
<li>命名规则为：[logger_loggerName]、[handler_handlerName]、[formatter_formatterName]。</li>
<li>定义logger 的 section 中<strong>必须</strong>指定 level、handlers。</li>
<li>非 root logger 还有一些额外的 option，</li>
<li>qualname（<strong>必须</strong>）（表示在logger层级中的名字，代码中通过这个名字得到 logger）</li>
<li>propagate（可选）（默认为1，表示将消息传递给更高层次的 logger 的 handler，一般指定为0）</li>
</ul>
</blockquote>
<p>handler:</p>
<blockquote>
<ul>
<li><strong>必须</strong>指定 class、args。可选 level、formatter。</li>
<li>class：handler 的类名。可以是相对 logging模块的相对值。如：FileHandler</li>
<li>args：传递给 “class” 的参数。<strong>必须</strong>是 tuple 类型。</li>
<li>level：等级</li>
<li>formatter：格式器。如果不指定，handler 将会以消息本身进行记录，而不会添加时间等信息。</li>
</ul>
</blockquote>
<p><a href="https://docs.python.org/3/library/logging.config.html#logging-config-dictschema" target="_blank" rel="noopener">参考</a></p>
<p>以 fileConfig 为例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">import</span> logging</span><br><span class="line">&gt; <span class="keyword">import</span> logging.config</span><br><span class="line">&gt; </span><br><span class="line">&gt; logging.config.fileConfig(<span class="string">"logger.conf"</span>)</span><br><span class="line">&gt; logger = logging.getLogger(<span class="string">"example01"</span>)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&gt; [loggers]</span><br><span class="line">&gt; keys = root</span><br><span class="line">&gt; </span><br><span class="line">&gt; [handlers]</span><br><span class="line">&gt; keys = mail, file, console</span><br><span class="line">&gt; </span><br><span class="line">&gt; [formatters]</span><br><span class="line">&gt; keys = format</span><br><span class="line">&gt; </span><br><span class="line">&gt; [logger_root]</span><br><span class="line">&gt; level = INFO</span><br><span class="line">&gt; handlers = mail, file, console</span><br><span class="line">&gt; propagate = 0</span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; [handler_mail]</span><br><span class="line">&gt; class = handlers.SMTPHandler</span><br><span class="line">&gt; level = ERROR</span><br><span class="line">&gt; formatter = format</span><br><span class="line">&gt; args = (&apos;smtp.163.com&apos;, &apos;sqmeddb@163.com&apos;, &apos;csniu@smartquerier.com&apos;, &apos;Errors from chemotherapy on small reports system&apos;, (&apos;sqmeddb@163.com&apos;, &apos;authformeddb2018&apos;))</span><br><span class="line">&gt; </span><br><span class="line">&gt; [handler_file]</span><br><span class="line">&gt; class = handlers.TimedRotatingFileHandler</span><br><span class="line">&gt; level = INFO</span><br><span class="line">&gt; formatter = format</span><br><span class="line">&gt; args = (&apos;log/chem.log&apos;, &apos;d&apos;, 1, 0, &apos;utf-8&apos;)</span><br><span class="line">&gt; </span><br><span class="line">&gt; [handler_console]</span><br><span class="line">&gt; class = StreamHandler</span><br><span class="line">&gt; level = INFO</span><br><span class="line">&gt; formatter = format</span><br><span class="line">&gt; args = (sys.stdout,)</span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; [formatter_format]</span><br><span class="line">&gt; format=%(asctime)s %(filename)s[line:%(lineno)d] %(levelname)s %(message)s</span><br><span class="line">&gt; datefmt=%m/%d/%Y %I:%M:%S %p</span><br><span class="line">&gt; </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="二、handler"><a href="#二、handler" class="headerlink" title="二、handler"></a>二、handler</h4><hr>
<p>定义将日志信息发送到哪里。文件、网络、邮箱。</p>
<p>基本上不需要开发者关心，直接调用就可以。</p>
<p>一些常用的 Handler 定义在 <code>__init__.py</code>，不太常用的都定义在 <code>handler</code>中。如下</p>
<table>
<thead>
<tr>
<th>Handler</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>logging.StreamHandler(stream)</td>
<td>将日志消息发送到Stream，如std.out, std.err或任何file-like对象。默认 sys.stderr(控制台)</td>
</tr>
<tr>
<td>logging.FileHandler(filename, mode=’a’,encoding=None, delay=False)</td>
<td>将日志消息发送到磁盘文件，默认情况下文件大小会无限增大。</td>
</tr>
<tr>
<td>logging.handlers.RotatingFileHandler</td>
<td>将日志消息发送到磁盘文件，并支持日志文件按大小切割。文件达到一定大小，会进行重命名。</td>
</tr>
<tr>
<td>logging.hanlders.TimedRotatingFileHandler</td>
<td>将日志消息发送到磁盘文件，并支持日志文件按时间切割。可设置每天、每周等。</td>
</tr>
<tr>
<td>logging.handlers.HTTPHandler</td>
<td>将日志消息以GET或POST的方式发送给一个HTTP服务器</td>
</tr>
<tr>
<td>logging.handlers.SMTPHandler</td>
<td>将日志消息发送给一个指定的email地址</td>
</tr>
<tr>
<td>logging.NullHandler</td>
<td>该Handler实例会忽略error messages，通常被想使用logging的library开发者使用来避免’No handlers could be found for logger XXX’信息的出现。</td>
</tr>
</tbody>
</table>
<h4 id="三、formatter"><a href="#三、formatter" class="headerlink" title="三、formatter"></a>三、formatter</h4><hr>
<p>决定日志记录的最终输出格式。</p>
<p>可用格式化：</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>%(name)s</td>
<td>Logger的名字</td>
</tr>
<tr>
<td>%(levelno)s</td>
<td>数字形式的日志级别</td>
</tr>
<tr>
<td>%(levelname)s</td>
<td>文本形式的日志级别</td>
</tr>
<tr>
<td>%(pathname)s</td>
<td>调用日志输出函数的模块的完整路径名，可能没有</td>
</tr>
<tr>
<td>%(filename)s</td>
<td>调用日志输出函数的模块的文件名</td>
</tr>
<tr>
<td>%(module)s</td>
<td>调用日志输出函数的模块名</td>
</tr>
<tr>
<td>%(funcName)s</td>
<td>调用日志输出函数的函数名</td>
</tr>
<tr>
<td>%(lineno)d</td>
<td>调用日志输出函数的语句所在的代码行</td>
</tr>
<tr>
<td>%(created)f</td>
<td>当前时间，用UNIX标准的表示时间的浮 点数表示</td>
</tr>
<tr>
<td>%(relativeCreated)d</td>
<td>输出日志信息时的，自Logger创建以 来的毫秒数</td>
</tr>
<tr>
<td>%(asctime)s</td>
<td>字符串形式的当前时间。默认格式是 “2003-07-08 16:49:45,896”。逗号后面的是毫秒</td>
</tr>
<tr>
<td>%(thread)d</td>
<td>线程ID。可能没有</td>
</tr>
<tr>
<td>%(threadName)s</td>
<td>线程名。可能没有</td>
</tr>
<tr>
<td>%(process)d</td>
<td>进程ID。可能没有</td>
</tr>
<tr>
<td>%(message)s</td>
<td>用户输出的消息</td>
</tr>
</tbody>
</table>
<h4 id="四、filter"><a href="#四、filter" class="headerlink" title="四、filter"></a>四、filter</h4><hr>
<p>ilter可以被Handler和Logger用来做比level更细粒度的、更复杂的过滤功能。Filter是一个过滤器基类，它只允许某个logger层级下的日志事件通过过滤。该类定义如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">logging</span>.<span class="title">Filter</span><span class="params">(name=<span class="string">''</span>)</span></span></span><br><span class="line"><span class="class">    <span class="title">filter</span><span class="params">(record)</span></span></span><br></pre></td></tr></table></figure>
<p>配置文件是使用过滤器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'filters'</span>: &#123;</span><br><span class="line">    <span class="string">'require_debug_false'</span>: &#123;</span><br><span class="line">            <span class="string">'()'</span>: <span class="string">'django.utils.log.RequireDebugFalse'</span>,  <span class="comment"># 当 DEBUG = True，过滤所有信息</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h4 id="五、写日志"><a href="#五、写日志" class="headerlink" title="五、写日志"></a>五、写日志</h4><hr>
<p>在配置好 longing 和实例化 logger 后，就是写日志了，如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">logger.fileConfig(<span class="string">'file'</span>)</span><br><span class="line">log = logging.getLogger(__name__)</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>log.debug()</td>
<td>写一条 dubug 级别的日志信息。</td>
</tr>
<tr>
<td>log.info()</td>
<td>写一条 info级别的日志信息。</td>
</tr>
<tr>
<td>log.warning()</td>
<td>写一条 warning级别的日志信息。</td>
</tr>
<tr>
<td>log.error()</td>
<td>写一条 error级别的日志信息。</td>
</tr>
<tr>
<td>log.critical()</td>
<td>写一条 critical级别的日志信息。</td>
</tr>
</tbody>
</table>
<h4 id="六、logging日志流处理流程"><a href="#六、logging日志流处理流程" class="headerlink" title="六、logging日志流处理流程"></a>六、logging日志流处理流程</h4><hr>
<p><img src="https://images2015.cnblogs.com/blog/1063221/201705/1063221-20170511145312144-488305597.png" alt="logging日志流处理流程"></p>
<p>我们来描述下上面这个图的日志流处理流程：</p>
<ul>
<li>1）（在用户代码中进行）日志记录函数调用，如：logger.info(…)，logger.debug(…)等；</li>
<li>2）判断要记录的日志级别是否满足日志器设置的级别要求（要记录的日志级别要大于或等于日志器设置的级别才算满足要求），如果不满足则该日志记录会被丢弃并终止后续的操作，如果满足则继续下一步操作；</li>
<li>3）根据日志记录函数调用时掺入的参数，创建一个日志记录（LogRecord类）对象；</li>
<li>4）判断日志记录器上设置的过滤器是否拒绝这条日志记录，如果日志记录器上的某个过滤器拒绝，则该日志记录会被丢弃并终止后续的操作，如果日志记录器上设置的过滤器不拒绝这条日志记录或者日志记录器上没有设置过滤器则继续下一步操作–将日志记录分别交给该日志器上添加的各个处理器；</li>
<li>5）判断要记录的日志级别是否满足处理器设置的级别要求（要记录的日志级别要大于或等于该处理器设置的日志级别才算满足要求），如果不满足记录将会被该处理器丢弃并终止后续的操作，如果满足则继续下一步操作；</li>
<li>6）判断该处理器上设置的过滤器是否拒绝这条日志记录，如果该处理器上的某个过滤器拒绝，则该日志记录会被当前处理器丢弃并终止后续的操作，如果当前处理器上设置的过滤器不拒绝这条日志记录或当前处理器上没有设置过滤器测继续下一步操作；</li>
<li>7）如果能到这一步，说明这条日志记录经过了层层关卡允许被输出了，此时当前处理器会根据自身被设置的格式器（如果没有设置则使用默认格式）将这条日志记录进行格式化，最后将格式化后的结果输出到指定位置（文件、网络、类文件的Stream等）；</li>
<li>8）如果日志器被设置了多个处理器的话，上面的第5-8步会执行多次；</li>
<li>9）这里才是完整流程的最后一步：判断该日志器输出的日志消息是否需要传递给上一级logger（之前提到过，日志器是有层级关系的）的处理器，如果propagate属性值为1则表示日志消息将会被输出到处理器指定的位置，同时还会被传递给parent日志器的handlers进行处理直到当前日志器的propagate属性为0停止，如果propagate值为0则表示不向parent日志器的handlers传递该消息，到此结束。</li>
</ul>
<p>可见，一条日志信息要想被最终输出需要依次经过以下几次过滤：</p>
<ul>
<li>日志器等级过滤；</li>
<li>日志器的过滤器过滤；</li>
<li>日志器的处理器等级过滤；</li>
<li>日志器的处理器的过滤器过滤；</li>
</ul>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><hr>
<blockquote>
<p><a href="https://docs.python.org/3/library/logging.html" target="_blank" rel="noopener">python docs</a></p>
<p><a href="https://pythonguidecn.readthedocs.io/zh/latest/writing/logging.html" target="_blank" rel="noopener">文档</a></p>
<p><a href="https://www.cnblogs.com/yyds/p/6901864.html" target="_blank" rel="noopener">云游道士</a></p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/11/Django-form/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="csniu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李大宝的包子">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/11/Django-form/" itemprop="url">Django form</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-11T15:59:47+08:00">2019-03-11</time>
            

            
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Develop/" itemprop="url" rel="index"><span itemprop="name">Develop</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="django-form"><a href="#django-form" class="headerlink" title="django-form"></a>django-form</h1><h3 id="一、Form"><a href="#一、Form" class="headerlink" title="一、Form"></a>一、Form</h3><p>  在 HTML 中， 表单是在 <code>&lt;form&gt;....&lt;/form&gt;</code> 中的一些元素，用于收集不同类型的用户输入。</p>
<p>  一个完整的表单主要包括：</p>
<blockquote>
<p>* 提交地址：action 属性指定，决定提交的数据由那个 url 接受和处理。若为空，则表示由当前 url 接受。</p>
<p>* 请求方式：method 属性指定。</p>
<p>* 元素控件：input 标签。获取输入数据，由其 type 属性定义输入数据的类型，常见如下：</p>
<blockquote>
<p>ext：文本，默认是20个字符长</p>
<p>password：密码，不会明文显示，而是以星号或圆点替代。</p>
<p>radio：单选框</p>
<p>checkbox：复选框</p>
<p>submit：提交，当用户单击确认按钮时，表单的内容会被传送到另一个文件。表单的动作属性定义了目的文件的文件名。</p>
</blockquote>
<p>* 提交按钮：input 标签，type=submit</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"input"</span> <span class="attr">action</span>=<span class="string">"html_form_action.php"</span> <span class="attr">method</span>=<span class="string">"get"</span>&gt;</span></span><br><span class="line">    First name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"firstname"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    Last name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"lastname"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>  <a href="http://www.runoob.com/html/html-forms.html" target="_blank" rel="noopener">参考</a></p>
<h3 id="二-django"><a href="#二-django" class="headerlink" title="二.django"></a>二.django</h3><p> 在模板中直接编写表单是很简单的事情，但是如果表单过多，会增加代码量，同时对日后的维护和更新带来很大的不便。django 封装了完善的表单功能，详情见<a href="https://docs.djangoproject.com/zh-hans/2.1/topics/forms/" target="_blank" rel="noopener">官方文档</a>。</p>
<p> 核心内容是 django 的 Form 类和其子类（ModelForm） 。</p>
<p>​    # ModelForm 是将模型的字段转换成表单字段，在从表单字段生成 Html 表单控件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.forms <span class="keyword">import</span> Form，ModelForm</span><br></pre></td></tr></table></figure>
<p>工作流程： </p>
<blockquote>
<p>* 1.自定义 Form 类，继承自 django.forms.From 或其子类。</p>
<p>* 2.在视图函数中实例化自定义的 Form 类，并传给模板。</p>
<p>* 3.模板中根据 Form 类动态生成对应的表单元素控件。</p>
</blockquote>
<h4 id="1-自定义-Form-类"><a href="#1-自定义-Form-类" class="headerlink" title="1.自定义 Form 类"></a>1.自定义 Form 类</h4><p>  在 app 下创建form.py。如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义数据验证函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">weight_validate</span><span class="params">(value)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> str(value).isdigit():</span><br><span class="line">        <span class="keyword">raise</span> ValidationError(<span class="string">'请输入正确的重量'</span>)</span><br><span class="line">        </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    <span class="comment"># 设置错误信息并设置样式</span></span><br><span class="line">    <span class="comment"># help_text 提示信息</span></span><br><span class="line">    <span class="comment"># required 是否必须需要，默认为True</span></span><br><span class="line">    name = forms.CharField(max_length=<span class="number">20</span>, label=<span class="string">'名字'</span>,</span><br><span class="line">                           widget=forms.widgets.TextInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">'c1'</span>&#125;),</span><br><span class="line">                           error_messages=&#123;<span class="string">'required'</span>: <span class="string">'名字不能为空'</span>&#125;,)</span><br><span class="line">    <span class="comment"># 使用自定义数据验证函数</span></span><br><span class="line">    weight = forms.CharField(max_length=<span class="number">50</span>, label=<span class="string">'重量'</span>,validators=[weight_validate])</span><br><span class="line">    size = forms.CharField(max_length=<span class="number">50</span>, label=<span class="string">'尺寸'</span>)</span><br><span class="line">    <span class="comment"># 获取数据库数据</span></span><br><span class="line">    choices_list = [(i+<span class="number">1</span>, v[<span class="string">'type_name'</span>]) <span class="keyword">for</span> i,v <span class="keyword">in</span> enumerate(Type.objects.values(<span class="string">'type_name'</span>))]</span><br><span class="line">    <span class="comment"># 设置CSS样式</span></span><br><span class="line">    type = forms.ChoiceField(widget=forms.widgets.Select(attrs=&#123;<span class="string">'class'</span>: <span class="string">'type'</span>,<span class="string">'size'</span>:<span class="string">'4'</span>&#125;),</span><br><span class="line">                             choices=choices_list,label=<span class="string">'产品类型'</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>*1. forms 中定义了很多的数据类型。<a href="https://docs.djangoproject.com/zh-hans/2.1/ref/forms/fields/" target="_blank" rel="noopener">所有字段</a></p>
<p>* 2.每个类字段对应 HTML 中的一个控件。</p>
<p>* 3.每个字段类型，也都有一些特定的参数，达到数据的规范型。<a href="https://docs.djangoproject.com/zh-hans/2.1/ref/forms/fields/" target="_blank" rel="noopener">说明</a></p>
<p>* 4.<strong>每个 Form 类都有一个 is_valid() 方法，用来验证数据，如果所有字段都包含数据，则会返回 True 并将表单数据放到它的 cleaned_data 中。</strong></p>
<p># 不包括<code>submit</code> 控件，要在模板中实现</p>
</blockquote>
<h4 id="2-实列化和模板"><a href="#2-实列化和模板" class="headerlink" title="2.实列化和模板"></a>2.实列化和模板</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">from</span> .form <span class="keyword">import</span> MyForm</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(request)</span>:</span></span><br><span class="line">    myform = MyForm()</span><br><span class="line">    <span class="keyword">return</span>  render(request, template_name=<span class="string">'patients/test.html'</span>, context=locals())</span><br></pre></td></tr></table></figure>
<blockquote>
<p>一般流程：</p>
<p>*1.判断请求方式</p>
<p>* 2.创建实例</p>
<blockquote>
<p>如果模板中表单的请求方式是 post。</p>
<p>如果判断请求方式也是 post 方法， 那么实例化时要用请求数据实例化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; &gt; myform = MyForm(request.POST)</span><br><span class="line">&gt; &gt;</span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>否则创建一个空的表单：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; &gt; myform = MyForm()</span><br><span class="line">&gt; &gt;</span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<blockquote>
<p>* 3.使用 is_valid 验证数据。</p>
<p>* 4.提取数据，处理数据。表单数据在 cleaned_data 属性中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; subject = myform.cleaned_data[<span class="string">'subject'</span>]</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>* 4.渲染模板</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># test.html</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    &#123;% if myform.errors %&#125;  <span class="comment">&lt;!-- 渲染表单错误 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">            数据出错啦，错误信息：&#123;&#123; myform.errors &#125;&#125;.</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">            &#123;% csrf_token %&#125;  <span class="comment">&lt;!-- 使用 csrf_token 标签，防止跨站攻击 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">                &#123;&#123; myform.as_table  &#125;&#125;  <span class="comment">&lt;!-- 使用实例化的 myform，自动创建表单控件  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p># 记得实现提交按钮</p>
</blockquote>
<blockquote>
<p>* <strong>1</strong>.如果实例化的表单名叫 ‘form’，那么模板中 <code></code>将渲染它为 Html 中相应的 <code>&lt;label&gt;</code> 和 <code>&lt;input&gt;</code> 元素。</p>
<p>* <strong>2</strong>.也可以渲染成其他标签，如下：</p>
<blockquote>
<p>1.<code></code>  ：<tr> 标签</tr></p>
<p>2.<code></code> ：</p><p> 标签</p>
<p>3.<code></code> ： <li> 标签</li></p>
<p># 但是要在模板中提供外层标签，<table> 、<ul> 等。</ul></table></p>
</blockquote>
<p>* <strong>3</strong>.同时 django 也提供了手动渲染的方式，<a href="https://docs.djangoproject.com/zh-hans/2.1/topics/forms/" target="_blank" rel="noopener">详情见文档</a></p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/08/Django-Haystack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="csniu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李大宝的包子">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/08/Django-Haystack/" itemprop="url">Django Haystack</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-08T14:00:03+08:00">2019-03-08</time>
            

            
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Develop/" itemprop="url" rel="index"><span itemprop="name">Develop</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="django-Haystack"><a href="#django-Haystack" class="headerlink" title="django-Haystack"></a>django-Haystack</h1><p>django 的第三方插件，提供可拔插式的搜索后端。支持 <a href="http://lucene.apache.org/solr/" target="_blank" rel="noopener">Solr</a>， <a href="http://elasticsearch.org/" target="_blank" rel="noopener">Elasticsearch</a>，<a href="https://bitbucket.org/mchaput/whoosh/" target="_blank" rel="noopener">Whoosh</a>，<a href="http://xapian.org/" target="_blank" rel="noopener">Xapian</a></p>
<p>等搜索引擎。是项目于搜索引擎解耦和。</p>
<h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h3><hr>
<blockquote>
<p><code>pip install django-haystack</code></p>
</blockquote>
<p><strong>1.安装引擎 （以 whoosh 为例）</strong></p>
<p><code>pip install whoosh</code></p>
<p><strong>2.中文搜索，</strong></p>
<p>因 whoosh 默认的分词是英文的对中文支持不是很友好，所以需要从新配置使用更加友好的 jieba 分词。</p>
<p>可直接修改 whoosh 的源码实现，当然这样是不明智的！</p>
<p>把 haystack\backends\whoosh_backend.py 文件拷贝到 app 目录下，并重命名为 whoosh_cn_backend.py </p>
<p>做一下修改：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">from</span> jieba.analyse <span class="keyword">import</span> ChineseAnalyzer</span><br><span class="line"></span><br><span class="line">- schema_fields[field_class.index_fieldname] = TEXT(stored=<span class="literal">True</span>, analyzer=StemmingAnalyzer(), field_boost=field_class.boost, sortable=<span class="literal">True</span>)</span><br><span class="line">+ schema_fields[field_class.index_fieldname] = TEXT(stored=<span class="literal">True</span>, analyzer=ChineseAnalyzer(),field_boost=field_class.boost, sortable=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2-配置django-project"><a href="#2-配置django-project" class="headerlink" title="2.配置django project"></a>2.配置django project</h3><hr>
<p><strong>配置 settings.py </strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">    <span class="string">'patients.apps.PatientsConfig'</span>,</span><br><span class="line">    <span class="string">'haystack'</span>, <span class="comment"># 添加 app</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 haystack</span></span><br><span class="line">HAYSTACK_CONNECTIONS = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'patients.whoosh_cn_backend.WhooshEngine'</span>,  <span class="comment"># 选择引擎（修改后支持中文引擎, patients 为 app 名）</span></span><br><span class="line">        <span class="string">'PATH'</span>: os.path.join(BASE_DIR, <span class="string">'whoosh_index'</span>),  <span class="comment"># 索引存放的位置，需要手动创建</span></span><br><span class="line">        <span class="string">'INCLUDE_SPELLING'</span>: <span class="literal">True</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置每页显示的数据量</span></span><br><span class="line">HAYSTACK_SEARCH_RESULTS_PER_PAGE = <span class="number">50</span></span><br><span class="line"><span class="comment"># 当数据库改变时，会自动更新索引</span></span><br><span class="line">HAYSTACK_SIGNAL_PROCESSOR = <span class="string">'haystack.signals.RealtimeSignalProcessor'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他详细配置参见官方文档</span></span><br></pre></td></tr></table></figure>
<p># <code>HAYSTACK_SIGNAL_PROCESSOR</code>是通过 django 的 save 信号来更新的。直接操作数据库是不会更新索引的。</p>
<h3 id="3-原理及各文件编写（whoosh）"><a href="#3-原理及各文件编写（whoosh）" class="headerlink" title="3.原理及各文件编写（whoosh）"></a>3.原理及各文件编写（whoosh）</h3><hr>
<h4 id="1-为数据的特定字段创建索引，用于快速搜索"><a href="#1-为数据的特定字段创建索引，用于快速搜索" class="headerlink" title="1.为数据的特定字段创建索引，用于快速搜索"></a>1.为数据的特定字段创建索引，用于快速搜索</h4><h5 id="一、创建索引类"><a href="#一、创建索引类" class="headerlink" title="一、创建索引类"></a>一、创建索引类</h5><p><em>索引类本质就是做一个到 model 的映射关系，可以设置检索字段、过滤数据 等其他自定设置。</em></p>
<p><strong>1.</strong> 在 app 下创建 search_indexes.py 。默认文件名，请勿修改</p>
<p><strong>2.</strong>编写 search_indexes.py 如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> haystack <span class="keyword">import</span> indexes</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Main</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainIndex</span><span class="params">(indexes.SearchIndex, indexes.Indexable)</span>:</span>  <span class="comment"># 类名必须为模型名+Index</span></span><br><span class="line">    text = indexes.CharField(document=<span class="literal">True</span>, use_template=<span class="literal">True</span>) </span><br><span class="line">    <span class="comment"># use_template=True 使用索引模板建立索引文件</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_model</span><span class="params">(self)</span>:</span>  <span class="comment"># 设置模型</span></span><br><span class="line">        <span class="keyword">return</span> Main</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index_queryset</span><span class="params">(self, using=None)</span>:</span>  <span class="comment"># 设置查询范围</span></span><br><span class="line">        <span class="keyword">return</span> self.get_model().objects.all()</span><br></pre></td></tr></table></figure>
<p><strong>document=True </strong></p>
<blockquote>
<p>1.使用此字段的内容作为索引进行检索。</p>
<p>2.每个索引类，都需要有一个字段设置为 True， 并且是唯一一个。</p>
<p>3.此字段名习惯命名为 text。</p>
</blockquote>
<p><strong>use_template=True</strong></p>
<blockquote>
<p>1.使用索引模板建立索引文件</p>
<p>2.索引模板的命名规则： 模型名（小写）+_text.txt。</p>
<p>3.保存路径：templates/search/indexes/myapp/  (一般放在 app 下)</p>
<blockquote>
<p>myapp 是对应模型定义在的 app 名，不是当前app。</p>
<p># 如在app1 里建立索引，但是用到模型是定义在 app2 中。那么保存的全路径应该是：</p>
<p>‘myproject’/app1/templates/search/indexes/app2/‘model_name’_text.txt</p>
</blockquote>
<p>4.编写 patients\templates\search\indexes\patients\main_text.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; &#123;&#123; object.drug &#125;&#125;</span><br><span class="line">&gt; &#123;&#123; object.summary &#125;&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p># 对应模型里的字段名</p>
<p><strong>text = indexes.CharField(document=True, use_template=True)</strong></p>
<blockquote>
<p>根据 text 创建索引（document=True），text 对应对应数据库中的字段（在所有模板中编写）（use_template=True）</p>
</blockquote>
<h5 id="二、通过命令创建索引"><a href="#二、通过命令创建索引" class="headerlink" title="二、通过命令创建索引"></a>二、通过命令创建索引</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py rebuild_index</span><br></pre></td></tr></table></figure>
<p># 看到 <code>Prefix dict has been built succesfully.</code>  就表示创建成功了。</p>
<p><a href="https://django-haystack.readthedocs.io/en/v2.8.1/management_commands.html" target="_blank" rel="noopener">管理命令说明 </a></p>
<p>1.会在根据 model 的 drug、summary 字段创建索引（索引类、索引模板设置）</p>
<p>2.索引保存在根目录下的 whoosh_index 文件夹下（settings 中设置）</p>
<h4 id="2-配置路由和编写视图函数"><a href="#2-配置路由和编写视图函数" class="headerlink" title="2.配置路由和编写视图函数"></a>2.配置路由和编写视图函数</h4><p><strong>1.配置路由 （urls.py）</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ path(<span class="string">''</span>, MySearchView.as_view(), name=<span class="string">'haystack'</span>)</span><br></pre></td></tr></table></figure>
<p><strong>2.编写视图函数</strong></p>
<blockquote>
<p>1.视图函数使用继承 haystack 封装好的 SearchView 类，并经行重载的方法实现。</p>
<blockquote>
<p>1.版本2.4开始不推荐使用 haystack.views.SearchView，而是使用更标准的 haystack.generic_views.SearchView</p>
</blockquote>
<p>2.SearchView 封装了 表单（build_form）、查询（get_query、get_results）、返回 Response （render_to_response）等步骤。可通过重载实现自定义。</p>
<p>3.SearchView 默认使用的 Form 为 ModelSearchForm， ModelSearchForm 也是继承 SearchForm，即所有的 Form 类都因该继承 SearchForm（自定义）。</p>
</blockquote>
<p>一、自定义表单</p>
<blockquote>
<p>1.编写表单类， 并继承 SearchForm。</p>
<p>2.设置视图的 form_class 字段。</p>
<p>3.重载 search 方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line">&gt; <span class="keyword">from</span> haystack.forms <span class="keyword">import</span> SearchForm</span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="class"><span class="keyword">class</span> <span class="title">DateRangeSearchForm</span><span class="params">(SearchForm)</span>:</span></span><br><span class="line">&gt; <span class="comment"># 在表单中定义 start_date， end_date 字段，默认只有一个 q 字段</span></span><br><span class="line">&gt; start_date = forms.DateField(required=<span class="literal">False</span>)</span><br><span class="line">&gt; end_date = forms.DateField(required=<span class="literal">False</span>)</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self)</span>:</span></span><br><span class="line">&gt; sqs = super(DateRangeSearchForm, self).search()  <span class="comment"># 父类的结果</span></span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">if</span> <span class="keyword">not</span> self.is_valid():</span><br><span class="line">&gt;   <span class="keyword">return</span> self.no_query_found()</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">if</span> self.cleaned_data[<span class="string">'start_date'</span>]:  <span class="comment"># 如果表单中有 start_date，如何处理</span></span><br><span class="line">&gt;   sqs = sqs.filter(pub_date__gte=self.cleaned_data[<span class="string">'start_date'</span>])</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">if</span> self.cleaned_data[<span class="string">'end_date'</span>]:  <span class="comment"># 如果表单中有 end_date，如何处理</span></span><br><span class="line">&gt;   sqs = sqs.filter(pub_date__lte=self.cleaned_data[<span class="string">'end_date'</span>])</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">return</span> sqs</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
</blockquote>
<p>二、自定义查询数据</p>
<blockquote>
<p>重载 get_query 方法</p>
</blockquote>
<p>三、自定义模板渲染过程</p>
<blockquote>
<p>1.会先判断form是否有效，分别对应不同的函数form_invalid，form_valid，主要区别在于创建上下午数据。创建不同的 Response。</p>
<p>2.重载 get_context_data 实现对上下文数据的再处理。</p>
</blockquote>
<blockquote>
<p># <strong>得到的请求数据（<code>self.request.GET</code>）是 <code>&lt;QueryDict: {&#39;name&#39;: [&#39;&#39;], &#39;weight&#39;: [&#39;&#39;], &#39;size&#39;: [&#39;&#39;]}&gt;</code> 形式。即使是空的数据， is_valid 也是返回 True。</strong></p>
<p># <strong>这也就导致根本无法执行到 form_invalid 。</strong></p>
<p># <strong>暂时没有找到解决的办法，先绕行了，覆盖 get() 方法，以后再解决</strong></p>
</blockquote>
<p>views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySearchView</span><span class="params">(SearchView)</span>:</span></span><br><span class="line">    template_name = <span class="string">'search/search.html'</span>  <span class="comment"># 指定模板</span></span><br><span class="line">    form_class = DateRangeSearchForm  <span class="comment"># 自定自定义表单类</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span><span class="params">(self)</span>:</span>  <span class="comment"># 查询集</span></span><br><span class="line">        queryset = super(MySearchView, self).get_queryset()</span><br><span class="line">        <span class="keyword">return</span> queryset</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_context_data</span><span class="params">(self, *args, **kwargs)</span>:</span>  <span class="comment"># 上下文</span></span><br><span class="line">        context = super(MySearchView, self).get_context_data(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> context</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span>  <span class="comment"># get 请求</span></span><br><span class="line"></span><br><span class="line">        form_class = self.get_form_class()</span><br><span class="line">        form = self.get_form(form_class)</span><br><span class="line">        self.queryset = form.search()</span><br><span class="line"></span><br><span class="line">        cleaned_data = form.cleaned_data</span><br><span class="line">        q = cleaned_data.get(self.search_field, <span class="literal">None</span>)  <span class="comment"># 表单字段 q</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> q:  <span class="comment"># 有，返回查找结果</span></span><br><span class="line">            context = self.get_context_data(**&#123;</span><br><span class="line">                self.form_name: form,</span><br><span class="line">                <span class="string">'query'</span>: form.cleaned_data.get(self.search_field),</span><br><span class="line">                <span class="string">'object_list'</span>: self.queryset  <span class="comment"># 查找结果</span></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">return</span> render(self.request, template_name=self.template_name, context=locals())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>: <span class="comment"># 没有</span></span><br><span class="line">            context = self.get_context_data(**&#123;</span><br><span class="line">                self.form_name: form,</span><br><span class="line">                <span class="string">'query'</span>: form.cleaned_data.get(self.search_field),</span><br><span class="line">                <span class="string">'object_list'</span>: self.get_queryset()</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="keyword">return</span> render(self.request, template_name=self.template_name, context=locals())</span><br></pre></td></tr></table></figure>
<p><a href="https://django-haystack.readthedocs.io/en/v2.8.1/views_and_forms.html" target="_blank" rel="noopener">参考官方文档</a></p>
<p> <strong>3.编写模板</strong></p>
<p>  <code>‘haystack ’</code>的上下文是自带<strong>分页</strong>功能的，是非常的方便的。默认上下文中包括如下字段：</p>
<blockquote>
<p>‘paginator’: 分页对象<br>‘page_obj’: 当前页对象<br>‘is_paginated’: 是否分页,<br>‘object_list’: 当前页包含的所有数据。<code>SearchResult</code>类对象。<a href="https://django-haystack.readthedocs.io/en/v2.8.1/searchresult_api.html" target="_blank" rel="noopener">API</a><br>‘form’: 表单对象,<br>‘query’: 查询字段<br>‘view’: 视图函数对象</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 生成表单 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">action</span>=<span class="string">""</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">            &#123;&#123; form.as_table &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Search"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment">&lt;!-- 展示数据 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        &#123;% if query %&#125;  <span class="comment">&lt;!-- 判断是否有查询字段 --&gt;</span></span><br><span class="line">        </span><br><span class="line">            &#123;% for object in object_list %&#125;  <span class="comment">&lt;!-- 遍历当前页的所有数据 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> &gt;</span>&#123;&#123; object.object.drug &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            &#123;% empty %&#125;  <span class="comment">&lt;!-- 结果为空时 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>No results found.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">            &#123;% if is_paginated %&#125;  <span class="comment">&lt;!-- 是否分页 --&gt;</span></span><br><span class="line">                &#123;% if page_obj.has_previous %&#125;  <span class="comment">&lt;!-- 是否有上一页 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'patients:haystack'%&#125;?q=&#123;&#123; query &#125;&#125;&amp;amp;page=&#123;&#123; page_obj.previous_page_number &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"prev"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">                &#123;% for page in paginator.page_range %&#125; <span class="comment">&lt;!-- 列出所有页 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'patients:haystack' %&#125;?q=&#123;&#123; query &#125;&#125;&amp;amp;page=&#123;&#123; page &#125;&#125;"</span> <span class="attr">target</span>=<span class="string">"_self"</span>&gt;</span>&#123;&#123;page&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">                &#123;% if page_obj.has_next %&#125;  <span class="comment">&lt;!-- 是否有下一页 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'patients:haystack' %&#125;?q=&#123;&#123; query &#125;&#125;&amp;amp;page=&#123;&#123; page_obj.next_page_number &#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"next"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<p><strong>问题1：在多个模型中查找</strong></p>
<p>  这个问题主要在于创建索引步骤。创建索引时可以创建多个索引，这样查找时就可以在多个模型中一起查找（默认），也可以指定在那个模型中查找，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> haystack <span class="keyword">import</span> indexes</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainIndex</span><span class="params">(indexes.SearchIndex, indexes.Indexable)</span>:</span>  <span class="comment"># 类名必须为模型名+Index</span></span><br><span class="line">    text = indexes.CharField(document=<span class="literal">True</span>, use_template=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_model</span><span class="params">(self)</span>:</span>  <span class="comment"># 设置模型</span></span><br><span class="line">        <span class="keyword">return</span> Main</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index_queryset</span><span class="params">(self, using=None)</span>:</span>  <span class="comment"># 设置查询范围</span></span><br><span class="line">        <span class="keyword">return</span> self.get_model().objects.all()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PatientBaseInfoIndex</span><span class="params">(indexes.SearchIndex, indexes.Indexable)</span>:</span></span><br><span class="line">    text = indexes.CharField(document=<span class="literal">True</span>, use_template=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_model</span><span class="params">(self)</span>:</span>  </span><br><span class="line">        <span class="keyword">return</span> PatientBaseInfo</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index_queryset</span><span class="params">(self, using=None)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.get_model().objects.all()</span><br></pre></td></tr></table></figure>
<p># 然后正常通过命令创建索引就可以。</p>
<p># 如果想在模板中判断查找的结果是那个模型的数据，可以定义模板过滤器的模型名。如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@register.filter</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_class_name</span><span class="params">(value)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> value.__class__.__name__</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; obj | to_class_name &#125;&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>问题2：多个搜索引擎</strong></p>
<p>直接在项目的 settings.py 中设置多个引擎就可以。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">HAYSTACK_CONNECTIONS = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'haystack.backends.solr_backend.SolrEngine'</span>,</span><br><span class="line">        <span class="string">'URL'</span>: <span class="string">'http://localhost:9001/solr/default'</span>,</span><br><span class="line">        <span class="string">'TIMEOUT'</span>: <span class="number">60</span> * <span class="number">5</span>,</span><br><span class="line">        <span class="string">'INCLUDE_SPELLING'</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">'BATCH_SIZE'</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="string">'SILENTLY_FAIL'</span>: <span class="literal">True</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'autocomplete'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'haystack.backends.whoosh_backend.WhooshEngine'</span>,</span><br><span class="line">        <span class="string">'PATH'</span>: <span class="string">'/home/search/whoosh_index'</span>,</span><br><span class="line">        <span class="string">'STORAGE'</span>: <span class="string">'file'</span>,</span><br><span class="line">        <span class="string">'POST_LIMIT'</span>: <span class="number">128</span> * <span class="number">1024</span> * <span class="number">1024</span>,</span><br><span class="line">        <span class="string">'INCLUDE_SPELLING'</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">'BATCH_SIZE'</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="string">'SILENTLY_FAIL'</span>: <span class="literal">True</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'slave'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'xapian_backend.XapianEngine'</span>,</span><br><span class="line">        <span class="string">'PATH'</span>: <span class="string">'/home/search/xapian_index'</span>,</span><br><span class="line">        <span class="string">'INCLUDE_SPELLING'</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">'BATCH_SIZE'</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="string">'SILENTLY_FAIL'</span>: <span class="literal">True</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'db'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'haystack.backends.simple_backend.SimpleEngine'</span>,</span><br><span class="line">        <span class="string">'SILENTLY_FAIL'</span>: <span class="literal">True</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://django-haystack.readthedocs.io/en/v2.8.1/multiple_index.html" target="_blank" rel="noopener">官方说明</a></p>
<h3 id="SearchQuerySet"><a href="#SearchQuerySet" class="headerlink" title="SearchQuerySet"></a>SearchQuerySet</h3><hr>
<ul>
<li>Haystack 的查询方式主要是 SearchQuerySet 类实现。</li>
<li>查询方式类是与 django 的 Query。</li>
<li>主要有如下方法：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> haystack.query <span class="keyword">import</span> SearchQuerySet</span><br><span class="line">Q = SearchQuerySet()</span><br><span class="line"></span><br><span class="line">Q.filter(content=<span class="string">'egfr'</span>)</span><br><span class="line">Q.models(model_name).filter(content=<span class="string">'egfr'</span>)</span><br></pre></td></tr></table></figure>
<p># 其中查询参数有：</p>
<blockquote>
<p>content  ： 最常用的，‘包括’</p>
<p>contains</p>
<p>exact</p>
<p>gt</p>
<p>gte</p>
<p>lt</p>
<p>lte</p>
<p>in</p>
<p>startswith</p>
<p>endswith</p>
<p>range</p>
<p>fuzzy</p>
</blockquote>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/08/Django-Auth-认证系统/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="csniu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李大宝的包子">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/08/Django-Auth-认证系统/" itemprop="url">Django Auth 认证系统</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-08T13:59:30+08:00">2019-03-08</time>
            

            
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Develop/" itemprop="url" rel="index"><span itemprop="name">Develop</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="用户管理系统"><a href="#用户管理系统" class="headerlink" title="用户管理系统"></a>用户管理系统</h2><ul>
<li>用户管理的本质就是数据库中的一张或多张与用户相关的表，存储的用户的基本信息和权限及用户组等高级信息。</li>
<li>用户的登陆就是接受用户的请求信息（登陆信息），并和数据库中存储的信息相比较。判断用户是否注册和是否激活等状态，完成登陆操作。</li>
<li>注册就是在数据库中创建一条数据。但是要满足唯一性。</li>
</ul>
<p># 当然上面说到的都是最基本的过程，这中间还会有一些数据的检验与验证等等操作。</p>
<p># 在 Django 中也有很好的封装。但是也要明白最基本的原理。</p>
<h2 id="Django-Auth-认证系统"><a href="#Django-Auth-认证系统" class="headerlink" title="Django-Auth 认证系统"></a>Django-Auth 认证系统</h2><ul>
<li>django 中用户管理系统可分为三大部分：用户信息、用户权限、用户组，对应数据库在的表分别为：auth_user、auth_permission、auth-group。</li>
<li>django 的auth 的源码位于：django.contrib.auth，其中定义了很多的方法和类可供使用。</li>
<li>django 只是提供了通用的身份验证系统，但是并没有提供更加复杂的功能，如密码强度检验、限制登陆尝试、第三方身份验证等功能。这些功能一般是通过第三方实现。</li>
</ul>
<h3 id="一、在-django-中使用认证系统"><a href="#一、在-django-中使用认证系统" class="headerlink" title="一、在 django 中使用认证系统"></a>一、在 django 中使用认证系统</h3><hr>
<ul>
<li><p>django 是默认使用内置用户管理系统的。</p>
</li>
<li><p>settings 中关于 Auth 的设置项。</p>
<ul>
<li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,  <span class="comment"># 身份验证框架的核心</span></span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,  <span class="comment"># 内容类型系统，它允许权限与您创建的模型相关联。</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">AUTH_PASSWORD_VALIDATORS = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.UserAttributeSimilarityValidator'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.MinimumLengthValidator'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.CommonPasswordValidator'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'django.contrib.auth.password_validation.NumericPasswordValidator'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">]  <span class="comment"># 用户密码认证的验证器</span></span><br></pre></td></tr></table></figure>
</li>
<li><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,  <span class="comment"># 管理 跨请求的会话</span></span><br><span class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,  <span class="comment"># 使用会话将用户与请求相关联。</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="二、扩展-User"><a href="#二、扩展-User" class="headerlink" title="二、扩展 User"></a>二、扩展 User</h3><hr>
<ul>
<li>django 默认的 User 模型本质就是一个python 的类，一个orm 模型。只有一些必要的字段（即 auth_user 表）。如下：</li>
</ul>
<blockquote>
<table>
<thead>
<tr>
<th>字段</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Id</td>
<td>主键</td>
</tr>
<tr>
<td>Password</td>
<td>密码，默认使用 pbkdf2_sha256 方式加密存储</td>
</tr>
<tr>
<td>last_login</td>
<td>最后一次登陆时间</td>
</tr>
<tr>
<td>is_superuser</td>
<td>是否为超级用户</td>
</tr>
<tr>
<td>Username</td>
<td>用户名</td>
</tr>
<tr>
<td>first_name</td>
<td>名</td>
</tr>
<tr>
<td>last_name</td>
<td>姓</td>
</tr>
<tr>
<td>Email</td>
<td>邮件</td>
</tr>
<tr>
<td>is_staff</td>
<td>判断用户是否有进入 admin 系统的权限</td>
</tr>
<tr>
<td>is_active</td>
<td>判断用户是否是激活状态，一般不删除用户，而是把该值设置为 Felse</td>
</tr>
<tr>
<td>date_joined</td>
<td>创建时间</td>
</tr>
</tbody>
</table>
</blockquote>
<ul>
<li>这些字段在实际开发中一般是不够用的，这时就需要对其进行扩展了。一般有如下方法：</li>
</ul>
<blockquote>
<p><strong>1.</strong> 代理模型：当不需要数据库存储额外的信息时，只是需要一些新的方法时。可以对 User 模型进行继承和扩展。</p>
<p><strong>2.</strong> <strong>Profile 扩展</strong>：需要存储额外信息，但是不想改变原有的 User 模型。可以重新定义一个数据模型，并设置某个字段为 OneToOneField 使之与 User 进行关联。</p>
<p><strong>3.</strong> AbstractBaseUser 扩展：重新定义用户模型并继承致 AbstractBaseUser  类。此方法对 User 和数据库的影响很大。</p>
<p><strong>4.</strong> <strong>AbstractUser 扩展</strong>：重新定义用户模型并继承致 AbstractUser 类，该方法会替换原有的 User模型。（需要在 settings 中配置自定义的模型，<code>AUTH_USER_MODEL = &#39;user.MyUser&#39;</code>）</p>
</blockquote>
<p># 一般情况下推荐 Profile 和 AbstractUser 方法进行扩展。</p>
<p># AbstractUser 用于第一次数据库迁移之前。如果在进行第一次迁移后使用AbstractUser 方法，可以无法迁移，需要删除数据库和迁移文件才可以进行。</p>
<p># Profile 方法本质就是多建一张表，当然连表查询会影响性能。</p>
<p><strong><em>以  AbstractUser 方法为例：</em></strong>一般会创建一个 user app，并在 models.py 中扩展。</p>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line">&gt; <span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> AbstractUser</span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="class"><span class="keyword">class</span> <span class="title">MyUser</span><span class="params">(AbstractUser)</span>:</span></span><br><span class="line">&gt; patient_id = models.UUIDField(default=<span class="literal">None</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>)  <span class="comment"># 扩展一个字段</span></span><br><span class="line">&gt; </span><br><span class="line">&gt; <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">&gt;    <span class="keyword">return</span> self.username</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<h5 id="扩展完成后进入后台系统，会发现一个问题：没有用户管理"><a href="#扩展完成后进入后台系统，会发现一个问题：没有用户管理" class="headerlink" title="扩展完成后进入后台系统，会发现一个问题：没有用户管理"></a>扩展完成后进入后台系统，会发现一个问题：没有用户管理</h5><p>这是因为我们自定义的 MyUser 没有注册到后台管理系统中。需要在 admin.py 中进行注册操作。如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line">&gt; <span class="keyword">from</span> .models <span class="keyword">import</span> MyUser</span><br><span class="line">&gt; <span class="keyword">from</span> django.contrib.auth.admin <span class="keyword">import</span> UserAdmin</span><br><span class="line">&gt; </span><br><span class="line">&gt; @admin.register(MyUser)</span><br><span class="line">&gt; <span class="class"><span class="keyword">class</span> <span class="title">MyUserAdmin</span><span class="params">(UserAdmin)</span>:</span></span><br><span class="line">&gt; list_display = [<span class="string">'username'</span>,<span class="string">'email'</span>]</span><br><span class="line">&gt; </span><br><span class="line">&gt; fieldsets = list(UserAdmin.fieldsets)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p># 使用的是继承 UserAdmin类。其他和正常后台配置相同</p>
</blockquote>
<p><strong>django 除了定义好的 User 类为，还定义了 User 所需要的表单类</strong>，如下：<code>django.contrib.auth.forms</code></p>
<table>
<thead>
<tr>
<th>表单类</th>
<th>表单字段</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>UserCreationForm</td>
<td>username、password1、password2</td>
<td>创建新用户</td>
</tr>
<tr>
<td>UserChangeForm</td>
<td>password、User模型的全部字段</td>
<td>修改用户信息</td>
</tr>
<tr>
<td>AuthenticationForm</td>
<td>username、password</td>
<td>用于登陆功能的认证功能</td>
</tr>
<tr>
<td>PasswordResetForm</td>
<td>email</td>
<td>通过邮件方式重置密码</td>
</tr>
<tr>
<td>SetPasswordForm</td>
<td>password1、password2</td>
<td>设置密码，如果有旧密码不会对其验证</td>
</tr>
<tr>
<td>PasswordChangeForm</td>
<td>old_password、new_password1、new_password2</td>
<td>继承SetPasswordForm，会对旧密码进行验证</td>
</tr>
<tr>
<td>AdminPasswordChangeForm</td>
<td>password1、password2</td>
<td>admin 后台修改密码</td>
</tr>
</tbody>
</table>
<p>自定义表单是可以继承上述表单类经行扩展，如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.forms <span class="keyword">import</span> UserCreationForm</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> MyUser</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyUserCreationForm</span><span class="params">(UserCreationForm)</span>:</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span><span class="params">(UserCreationForm.Meta)</span>:</span></span><br><span class="line">        model = MyUser  <span class="comment"># 指定自定的用户类</span></span><br><span class="line">        <span class="comment"># 在注册界面添加邮箱、手机号码、微信号码和QQ号码</span></span><br><span class="line">        fields = UserCreationForm.Meta.fields + (<span class="string">'email'</span>, <span class="string">'mobile'</span>, <span class="string">'weChat'</span>, <span class="string">'qq'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="三、登陆"><a href="#三、登陆" class="headerlink" title="三、登陆"></a>三、登陆</h3><hr>
<ul>
<li>登陆的本质就是接受客户端的登陆信息，并与数据库信息比对，如果用户存在并且密码正确就可以完成登陆操作。</li>
<li>根据 MTV 模型，M 已经实现（MyUser），接下来分别实现 V 和 T。如下</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># form.py</span></span><br><span class="line"><span class="comment"># 定义一个简单的表单类</span></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    username = forms.CharField(label=<span class="string">'姓名'</span>, widget=forms.TextInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">'form-control'</span>&#125;))</span><br><span class="line">    password = forms.CharField(label=<span class="string">'姓名'</span>, widget=forms.PasswordInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">'form-control'</span>&#125;))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> login, authenticate</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> reverse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login_view</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        form = LoginForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():  <span class="comment"># 判断表单数据</span></span><br><span class="line">            username = form.cleaned_data.get(<span class="string">'username'</span>)</span><br><span class="line">            password = form.cleaned_data.get(<span class="string">'password'</span>)</span><br><span class="line">            user = authenticate(username=username, password=password) <span class="comment"># 认证用户</span></span><br><span class="line">            <span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                login(request, user)</span><br><span class="line">                <span class="keyword">return</span> redirect(reverse(viewname=<span class="string">'user:home'</span>, args=(user.id, )))  <span class="comment"># 重定向</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                tips = <span class="string">'用户名或密码错误！'</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'login.html'</span>, locals())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = LoginForm()</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'login.html'</span>, locals())</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># login.html</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        &#123;&#123; form.as_table  &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"登陆"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="四、注册"><a href="#四、注册" class="headerlink" title="四、注册"></a>四、注册</h3><hr>
<ul>
<li>注册的本质就是在数据库中的用户表中创建一条记录。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># form.py</span></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.forms <span class="keyword">import</span> UserCreationForm</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> MyUser</span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyUserCreationForm</span><span class="params">(UserCreationForm)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        super(MyUserCreationForm, self).__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment"># 设置 password1、password2 的样式</span></span><br><span class="line">        self.fields[<span class="string">'password1'</span>].widget = forms.PasswordInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">'txt tabInput'</span>, <span class="string">'placeholder'</span>:<span class="string">'密码,4-16位数字/字母/特殊符号(空格除外)'</span>&#125;)</span><br><span class="line">        self.fields[<span class="string">'password2'</span>].widget = forms.PasswordInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">'txt tabInput'</span>, <span class="string">'placeholder'</span>:<span class="string">'重复密码'</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span><span class="params">(UserCreationForm.Meta)</span>:</span></span><br><span class="line">        model = MyUser  <span class="comment"># 指定模型</span></span><br><span class="line">        </span><br><span class="line">         <span class="comment"># 设置需要注册的字段，默认只有 username</span></span><br><span class="line">        fields = UserCreationForm.Meta.fields +(<span class="string">'patient_id'</span>,)  </span><br><span class="line">        <span class="comment"># 设置字段的样式</span></span><br><span class="line">        widgets = &#123;</span><br><span class="line">            <span class="string">'patient_id'</span>: forms.widgets.TextInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">'txt tabInput'</span>, <span class="string">'placeholder'</span>:<span class="string">'患者编号'</span>&#125;),</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register_view</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        user = MyUserCreationForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> user.is_valid():</span><br><span class="line">            user.save()</span><br><span class="line">            <span class="keyword">return</span> redirect(reverse(viewname=<span class="string">'user:login'</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tips = str(user.errors)</span><br><span class="line">        <span class="keyword">return</span> render(request, template_name=<span class="string">'register.html'</span>, context=locals())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        user = MyUserCreationForm()</span><br><span class="line">        <span class="keyword">return</span> render(request, template_name=<span class="string">'register.html'</span>, context=locals())</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># register.html</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">        &#123;% csrf_token %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">            &#123;&#123; user.as_table &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="五、退出"><a href="#五、退出" class="headerlink" title="五、退出"></a>五、退出</h3><hr>
<ul>
<li>退出当前的登陆状态，本质上的删除 session 的 user 信息，django 的 logout 已经做好了封装。</li>
<li>同样的 login 函数也封装的在 session 中加入 user 的部分。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, redirect</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> login, authenticate, logout</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout_view</span><span class="params">(request)</span>:</span></span><br><span class="line">    logout(request)</span><br><span class="line">    <span class="keyword">return</span> redirect(reverse(viewname=<span class="string">'user:login'</span>))</span><br></pre></td></tr></table></figure>
<h3 id="六、修改密码"><a href="#六、修改密码" class="headerlink" title="六、修改密码"></a>六、修改密码</h3><hr>
<ul>
<li>首先要判断用户，再进行密码修改。</li>
</ul>
<h3 id="七、找回密码"><a href="#七、找回密码" class="headerlink" title="七、找回密码"></a>七、找回密码</h3><hr>
<ul>
<li>修改密码是在用户知道密码的情况下的操作，还有一中是用户忘记密码，进行密码重置的操作。</li>
<li>一般有短信找回和邮件找回。django 是内置了发邮件的功能的。所有一般使用邮件找回</li>
</ul>
<h5 id="1、配置邮件"><a href="#1、配置邮件" class="headerlink" title="1、配置邮件"></a>1、配置邮件</h5><blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; EMAIL_BACKEND = <span class="string">'django.core.mail.backends.smtp.EmailBackend'</span></span><br><span class="line">&gt; EMAIL_HOST= <span class="string">'imap.mxhichina.com'</span></span><br><span class="line">&gt; EMAIL_PORT= <span class="number">993</span></span><br><span class="line">&gt; EMAIL_HOST_USER = <span class="string">'csniu@smartquerier.com'</span></span><br><span class="line">&gt; EMAIL_HOST_PASSWORD = <span class="string">'Niu875311792'</span></span><br><span class="line">&gt; EMAIL_SUBJECT_PREFIX = <span class="string">'website'</span> <span class="comment"># 为邮件标题的前缀,默认是'[django]'</span></span><br><span class="line">&gt; EMAIL_USE_SSL = <span class="literal">True</span></span><br><span class="line">&gt; DEFAULT_FROM_EMAIL = SERVER_EMAIL = EMAIL_HOST_USER <span class="comment"># 设置发件人</span></span><br><span class="line">&gt; </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="八、用户权限和用户组"><a href="#八、用户权限和用户组" class="headerlink" title="八、用户权限和用户组"></a>八、用户权限和用户组</h3><hr>
<ul>
<li>用户权限主要是对不同用户设置不同的功能使用权限，”功能“主要以模型来划分。</li>
<li>每个模型都拥有 add、change、delete 的权限项。</li>
<li>django 已经内置了权限的管理，打开admin 可进行可视化的操作。</li>
<li>权限的本质就是就是数据库中 auth_user、auth_permissions、auth_groups 表的对应关系。</li>
<li>默认情况下，新创建的用户是没有设置任何权限的。（一般用户也不需要有后台管理的权限，只有内部人员才需要）</li>
<li>用户权限只适用于非超级用户</li>
</ul>
<p><strong>用户和权限管理的主要数据库表如下：</strong></p>
<p><img src="/images/django/django-auth.png" alt="django 用户和权限管理的主要数据库表"></p>
<h4 id="基本操作如下"><a href="#基本操作如下" class="headerlink" title="基本操作如下"></a>基本操作如下</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> Permission，Group, User</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找用户、权限、用户组</span></span><br><span class="line">user = User.object.filter()</span><br><span class="line">permission = Permission.objects.filter(codename=<span class="string">'add_produt'</span>)[<span class="number">0</span>]</span><br><span class="line">group = Group.object.filter()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断用户权限</span></span><br><span class="line">user.has_perm(<span class="string">'index.add_product'</span>)  <span class="comment"># index 为 app 名，add_product 为 auth_permissions 的codename 字段内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户权限</span></span><br><span class="line">user.user_permissions.set([permission_list])  <span class="comment"># 添加多个权限</span></span><br><span class="line">user.user_permissions.add(permission)  <span class="comment"># 添加权限</span></span><br><span class="line">user.user_permissions.remove(permission)  <span class="comment"># 删除权限</span></span><br><span class="line">user.user_permissions.clear(permission)  <span class="comment"># 清空权限</span></span><br><span class="line">user.user_permissions。values()  <span class="comment"># 所有权限</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户与用户组</span></span><br><span class="line">user.groups.add(group)  <span class="comment"># 绑定到用户组</span></span><br><span class="line">user.groups.remove(group)  <span class="comment"># 解除用户组</span></span><br><span class="line">user.groups.clear()  <span class="comment"># 解除所有用户组</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户组与用户</span></span><br><span class="line">group.user.add(user)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户组与权限</span></span><br><span class="line">group.permission.add(permission)</span><br></pre></td></tr></table></figure>
<h4 id="1-自定义模型权限"><a href="#1-自定义模型权限" class="headerlink" title="1.自定义模型权限"></a>1.自定义模型权限</h4><ul>
<li>在模型类的 Meta 中进行设置如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class mymodel(model.Model):</span><br><span class="line">    class Meta:</span><br><span class="line">        permissions = (</span><br><span class="line">        (&apos;visit_Product&apos;, &apos;Can visit Product&apos;)  # 分别对应 auth_permission 中的 codename 和那么字段</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<h4 id="2-视图函数中的权限判断"><a href="#2-视图函数中的权限判断" class="headerlink" title="2.视图函数中的权限判断"></a>2.视图函数中的权限判断</h4><ul>
<li>判断当前用户是否是在登陆状态。</li>
</ul>
<blockquote>
<ul>
<li>使用 login_required 装饰器，对当前访问进行判断。可进行预处理和重定向操作。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line">&gt; </span><br><span class="line">&gt; @login_required(login_url=<span class="string">'/user/login'</span>)</span><br><span class="line">&gt; <span class="function"><span class="keyword">def</span> <span class="title">home_view</span><span class="params">(request, user_id)</span>:</span></span><br><span class="line">&gt; <span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line">&gt; <span class="keyword">return</span> HttpResponse(<span class="string">'user id: &#123;&#125;'</span>.format(str(user_id)))</span><br><span class="line">&gt; </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>判断当前用户是否拥有相应权限。</li>
</ul>
<blockquote>
<ul>
<li>使用 permission_required 装饰器进行判断。如果没有权限可抛出异常或重定向到登陆页。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> permission_required </span><br><span class="line">&gt; </span><br><span class="line">&gt; @permission_required(perm=<span class="string">'index.visir_Product'</span>, login_url=<span class="string">'/user/login/'</span>)</span><br><span class="line">&gt; <span class="function"><span class="keyword">def</span> <span class="title">home_view</span><span class="params">(request, user_id)</span>:</span></span><br><span class="line">&gt; <span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line">&gt; <span class="keyword">return</span> HttpResponse(<span class="string">'user id: &#123;&#125;'</span>.format(str(user_id)))</span><br><span class="line">&gt; </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p># permission_required 的作用和内置的 has_perm 相同。</p>
</blockquote>
<ul>
<li>在模板中判断权限和用户</li>
</ul>
<blockquote>
<ul>
<li>模板中是通过上下文中的 user 对象进行<strong>用户判断</strong>，和 perms 对象进行<strong>权限判断</strong>的。</li>
<li>这两个变量是django 在渲染模板前自动生成和传递的。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; &#123;% if user.is_authenticated %&#125;  <span class="comment">&lt;!-- 判断用户是否登陆 --&gt;</span></span><br><span class="line">&gt; 	<span class="tag">&lt;<span class="name">P</span>&gt;</span>....<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&gt; &#123;% endif %&#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt; </span><br><span class="line">&gt; &#123;% if perms.index.add_product %&#125;</span><br><span class="line">&gt; 	<span class="tag">&lt;<span class="name">p</span>&gt;</span>....<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&gt; &#123;% endif %&#125;	</span><br><span class="line">&gt; </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="注意和参考"><a href="#注意和参考" class="headerlink" title="注意和参考"></a>注意和参考</h3><hr>
<ul>
<li>以上关于登陆、注册等实现的视图函数，都是通过自己实现逻辑和验证的。这种方法是不安全和低效的。在django 中已经定义了相应的视图函数类，在<code>django.contrib.auth.views</code> 中。可进行继承和自定义操作。</li>
<li>本文主要参考了 黄永祥老师著作的 《玩转 Django2.0》一书，和 django 的<a href="https://docs.djangoproject.com/zh-hans/2.1/topics/auth/" target="_blank" rel="noopener">官方文档</a></li>
</ul>
<p>以 django.contrib.auth.views.LoginView 为例，流程如下：</p>
<p>1.根据不同的请求方式 dispatch() 分配的不同的方法上：</p>
<p>2.get 和 post 请求的方法源码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># django.views.generic.edit.ProcessFormView</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProcessFormView</span><span class="params">(View)</span>:</span></span><br><span class="line">    <span class="string">"""Render a form on GET and processes it on POST."""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""Handle GET requests: instantiate a blank version of the form."""</span></span><br><span class="line">        <span class="keyword">return</span> self.render_to_response(self.get_context_data())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Handle POST requests: instantiate a form instance with the passed</span></span><br><span class="line"><span class="string">        POST variables and then check if it's valid.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        form = self.get_form()</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            <span class="keyword">return</span> self.form_valid(form)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> self.form_invalid(form)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># PUT is a valid HTTP verb for creating (with a known URL) or editing an</span></span><br><span class="line">    <span class="comment"># object, note that browsers only support POST for now.</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.post(*args, **kwargs)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/04/Python-单元测试/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="csniu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李大宝的包子">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/04/Python-单元测试/" itemprop="url">Python 单元测试</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-04T14:00:45+08:00">2019-03-04</time>
            

            
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Develop/" itemprop="url" rel="index"><span itemprop="name">Develop</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Python-单元测试"><a href="#Python-单元测试" class="headerlink" title="Python-单元测试"></a>Python-单元测试</h2><ul>
<li>测试就是对一段代码（一个函数、一个模块等）的评估。</li>
<li>通过输入不同的值，对结果的正确性进行判断。如果不是“理想”值，要么是被测试的代码有问题，要么是测试的输入值有问题。</li>
</ul>
<h4 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h4><p><strong>1.</strong><code>print</code></p>
<blockquote>
<ul>
<li>最简单的方法是通过 print。把代码的运行结果 print 出来，进行<strong>人工</strong>判断。</li>
<li>优缺点显而易见。就不多举例了。</li>
</ul>
</blockquote>
<p><strong>2.</strong>function or model</p>
<blockquote>
<ul>
<li>通过编写一个函数或者组织一个模块，对特定的代码进行测试。</li>
<li>简单的例子：</li>
</ul>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; &gt; <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(arg1, arg2)</span>:</span></span><br><span class="line">&gt; &gt; <span class="keyword">return</span> arg1 + arg2</span><br><span class="line">&gt; &gt; </span><br><span class="line">&gt; &gt; <span class="function"><span class="keyword">def</span> <span class="title">test_add</span><span class="params">()</span>:</span></span><br><span class="line">&gt; &gt; <span class="keyword">if</span> add(<span class="number">2</span>, <span class="number">3</span>) != <span class="number">5</span>:</span><br><span class="line">&gt; &gt;    <span class="keyword">raise</span> </span><br><span class="line">&gt; &gt; </span><br><span class="line">&gt; &gt; <span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">&gt; &gt; test_add()</span><br><span class="line">&gt; &gt;</span><br></pre></td></tr></table></figure>
</blockquote>
</blockquote>
<blockquote>
<ul>
<li>当然这样也可以达到测试的目的，但是从代码量、复用性还是从后续的执行和维护。都无疑添加了很大的工作量。</li>
</ul>
</blockquote>
<p><strong>3.</strong>framework</p>
<blockquote>
<ul>
<li>使用测试框架，本质上也是方法2，只不过更加的方便简洁。</li>
<li>现流行的框架有很多。各有各的特点。根据不同的需求选择不同的框架就可以。</li>
</ul>
</blockquote>
<h3 id="Framework—-unittest"><a href="#Framework—-unittest" class="headerlink" title="Framework—-unittest"></a>Framework—-unittest</h3><hr>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://docs.python.org/3/library/unittest.html" target="_blank" rel="noopener">官方文档</a></p>
<p><a href="https://blog.csdn.net/huilan_same/article/details/52944782" target="_blank" rel="noopener">csdn</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/21/Django-分页/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="csniu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李大宝的包子">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/21/Django-分页/" itemprop="url">Django 分页</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-21T17:00:25+08:00">2019-02-21</time>
            

            
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Develop/" itemprop="url" rel="index"><span itemprop="name">Develop</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="django-分页"><a href="#django-分页" class="headerlink" title="django 分页"></a>django 分页</h2><p>django 的分页管理对象是 <a href="https://docs.djangoproject.com/zh-hans/2.1/topics/pagination/#django.core.paginator.Paginator" target="_blank" rel="noopener"><code>Paginator</code></a> 类 和 <code>Page</code> 类 。</p>
<p>实例化是需要两个参数，数据源和每页需要展示的条数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator</span><br><span class="line">objects = [<span class="string">'john'</span>, <span class="string">'paul'</span>, <span class="string">'george'</span>, <span class="string">'ringo'</span>]</span><br><span class="line">p = Paginator(objects, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>Paginator 的属性和方法：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>p.count</td>
<td>共分为多少页</td>
</tr>
<tr>
<td>p.page_range</td>
<td>页码生成器</td>
</tr>
<tr>
<td>page1 = p.page(1)</td>
<td>取得第一页 Page 对象, 超出范围抛出 EmptyPage 错误</td>
</tr>
<tr>
<td>page1.object_list</td>
<td>第一页的所有数据</td>
</tr>
<tr>
<td>page2.has_next()</td>
<td>返回有没有下一页的布尔值</td>
</tr>
<tr>
<td>page2.has_previous()</td>
<td>返回有没有前一页的布尔值</td>
</tr>
<tr>
<td>page2.has_other_pages()</td>
<td>返回有没有其他页的布尔值</td>
</tr>
<tr>
<td>page2.next_page_number()</td>
<td>返回下一页的页码，如果没有会抛出EmptyPage错误</td>
</tr>
<tr>
<td>page2.previous_page_number()</td>
<td>前一页</td>
</tr>
<tr>
<td>page2.start_index()</td>
<td>当前页的第一条数据 index</td>
</tr>
<tr>
<td>page2.end_index()</td>
<td>当前页最后一条 index</td>
</tr>
</tbody>
</table>
<p>视图函数中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">listing</span><span class="params">(request)</span>:</span></span><br><span class="line">    contact_list = Contacts.objects.all()</span><br><span class="line">    paginator = Paginator(contact_list, <span class="number">25</span>) <span class="comment"># 创建分页数据</span></span><br><span class="line"></span><br><span class="line">    page = request.GET.get(<span class="string">'page'</span>) </span><br><span class="line">    contacts = paginator.get_page(page)  </span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'list.html'</span>, &#123;<span class="string">'contacts'</span>: contacts&#125;)</span><br></pre></td></tr></table></figure>
<p>模板中：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for contact in contacts %&#125;</span><br><span class="line">    &#123;# Each "contact" is a Contact model object. #&#125;</span><br><span class="line">    &#123;&#123; contact.full_name|upper &#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"pagination"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"step-links"</span>&gt;</span></span><br><span class="line">        &#123;% if contacts.has_previous %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?page=1"</span>&gt;</span>&amp;laquo; first<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?page=&#123;&#123; contacts.previous_page_number &#125;&#125;"</span>&gt;</span>previous<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"current"</span>&gt;</span></span><br><span class="line">            Page &#123;&#123; contacts.number &#125;&#125; of &#123;&#123; contacts.paginator.num_pages &#125;&#125;.</span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        &#123;% if contacts.has_next %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?page=&#123;&#123; contacts.next_page_number &#125;&#125;"</span>&gt;</span>next<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?page=&#123;&#123; contacts.paginator.num_pages &#125;&#125;"</span>&gt;</span>last &amp;raquo;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/my_avatar.jpg" alt="csniu">
            
              <p class="site-author-name" itemprop="name">csniu</p>
              <p class="site-description motion-element" itemprop="description">python 学习笔记！</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                    <span class="site-state-item-count">1</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/csniu" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:dandyjefferson@gmail.com" target="_blank" title="E-Mail" rel="external nofollow"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">csniu</span>

  

  
</div>


  



  <div class="powered-by">由 <a class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" rel="external nofollow" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a> v6.1.0</div>




        








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  











  



  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/reading_progress/reading_progress.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.1.0"></script>



  



	





  





  






<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    






  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  

  

  

  

  
  
  
  <script src="/lib/bookmark/bookmark.min.js?v=1.0"></script>
  <script type="text/javascript">
  
    bookmark.loadBookmark();
  
  </script>


</body>
</html>
