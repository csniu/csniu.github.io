<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-loading-bar.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.1.0" rel="stylesheet" type="text/css">



  <link rel="icon" type="image/png" sizes="32x32" href="/images/my_favicon.png?v=6.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/my_favicon.png?v=6.1.0">










<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="SQL 是指结构化查询语言，全称”Structured Query Language“。是访问和处理 关系数据库（RDBMS） 的计算机标准语言。由ANSI组织和定义，主要标准有SQL92和SQL99。SQL语言按照功能可分为以下4类：  数据定义语言（DDL：Data Definition Language）：CREATE、ALTER、DROP。 数据操作语言（DML：Data Manipula">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL-基础篇">
<meta property="og:url" content="https://csniu.github.io/2020/03/06/SQL-基础篇/index.html">
<meta property="og:site_name" content="李大宝的包子">
<meta property="og:description" content="SQL 是指结构化查询语言，全称”Structured Query Language“。是访问和处理 关系数据库（RDBMS） 的计算机标准语言。由ANSI组织和定义，主要标准有SQL92和SQL99。SQL语言按照功能可分为以下4类：  数据定义语言（DDL：Data Definition Language）：CREATE、ALTER、DROP。 数据操作语言（DML：Data Manipula">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-03-12T09:10:33.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SQL-基础篇">
<meta name="twitter:description" content="SQL 是指结构化查询语言，全称”Structured Query Language“。是访问和处理 关系数据库（RDBMS） 的计算机标准语言。由ANSI组织和定义，主要标准有SQL92和SQL99。SQL语言按照功能可分为以下4类：  数据定义语言（DDL：Data Definition Language）：CREATE、ALTER、DROP。 数据操作语言（DML：Data Manipula">






  <link rel="canonical" href="https://csniu.github.io/2020/03/06/SQL-基础篇/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>SQL-基础篇 | 李大宝的包子</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-100475240-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-100475240-1');
</script>






  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <!--<a href="https://github.com/csniu" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>-->

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> 

<div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">李大宝的包子</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
          
  
  <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">3</span>
      </a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">6</span>
      </a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">17</span>
      </a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-commonweal">
    <a href="/404/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>公益 404</a>
</li>

      

      
    </ul>
  

  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://csniu.github.io/2020/03/06/SQL-基础篇/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="csniu">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/my_avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="李大宝的包子">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">SQL-基础篇</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-03-06T09:53:29+08:00">2020-03-06</time>
            

            
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/03/06/SQL-基础篇/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/03/06/SQL-基础篇/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>SQL 是指结构化查询语言，全称”Structured Query Language“。是访问和处理 <strong>关系数据库（RDBMS）</strong> 的计算机标准语言。由ANSI组织和定义，主要标准有SQL92和SQL99。SQL语言按照功能可分为以下4类：</p>
<ul>
<li>数据定义语言（DDL：Data Definition Language）：CREATE、ALTER、DROP。</li>
<li>数据操作语言（DML：Data Manipulation Language）：INSERT、UPDATE、DELETE。</li>
<li>数据控制语言（DCL：Data Control Language）：权限和安全。</li>
<li>数据查询语言（DQL：Data Query Language）：SELECT。</li>
</ul>
<!-- - 事务处理语言（TPL）：BEGIN TRANSACTION、COMMIT、ROLLBACK。-->
<!-- - 数据控制语言（DCL）-->
<!-- - 指针控制语言（CCL）-->
<p>语法特点：</p>
<ul>
<li>总是以关键字开始并以”;”结尾。</li>
<li>不区分大小写。但是一般约定：<ul>
<li>SQL 保留字、函数名、绑定变量等都大写。</li>
<li>表名、表别名、字段名、字段别名等都小写。</li>
</ul>
</li>
</ul>
<p><strong><em>注意：SQL本身是标准的语言，但不同DBMS对其支持不同，而且多数对其还进行的扩展。在实际使用中还需注意。</em></strong></p>
<a id="more"></a>
<h1 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h1><p>DB（DataBase）：数据库，是存储数据的集合。</p>
<p>DBMS（DataBase Management System）：数据库管理系统。DBMS = 多个数据库 + 管理软件。</p>
<ul>
<li>我日常说的Oracle、MySQL数据库，严格来说应该是DBMS。</li>
</ul>
<p>RDBMS（Relational Database Management System）：关系数据库管理系统。SQL就是其查询语言。</p>
<p>相比于SQL，NoSQL泛指非关系型数据库，包括</p>
<ul>
<li>键值型数据库：知道key时查询速度快，否则要遍历所有数据。一般用作缓存和消息中间件，代表是Redis。</li>
<li>文档型数据库：MongoDB。</li>
<li>搜索引擎：全文搜索效率高。Elasticsearch、Splunk、Solr。</li>
<li>列存储：降低系统的 I/O，适合于分布式文件系统，不足在于功能相对有限。</li>
<li>图形数据库：能高效地解决复杂的关系问题。</li>
<li>等等。</li>
</ul>
<p>NoSQL 在不同时期有着不同定义，现在更多的定义为“Not only SQL”。所有SQL与NoSQL并不是完全对立的两个阵营，应该是相辅相成的两种技术。</p>
<h1 id="关系数据库"><a href="#关系数据库" class="headerlink" title="关系数据库"></a>关系数据库</h1><p>RDBMS是关系数据库管理系统(Relational Database Management System)的缩写，是一种基于E.F.Codd提出的关系模型的数据库管理系统，也是 SQL 的基础。</p>
<ul>
<li>数据存储在称为”表“的数据库对象中。表由”列“和”行“组成。</li>
<li>”列“名称为”字段“，每一列存储的数据类型必须相同。</li>
<li>”行“也称为“数据行”，是存储一条单独数据的地方。</li>
</ul>
<h2 id="主流关系数据库"><a href="#主流关系数据库" class="headerlink" title="主流关系数据库"></a>主流关系数据库</h2><p>商用数据库：Oracle、SQL Server、DB2。</p>
<p>开源数据库：MySQL（MariaDB）、PostgreSQL。</p>
<p>桌面数据库：Access。</p>
<p>嵌入式数据库：SQLite。</p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>INT</td>
<td>整型</td>
<td>4字节整数类型，范围约+/-21亿</td>
</tr>
<tr>
<td>BIGINT</td>
<td>长整型</td>
<td>8字节整数类型，范围约+/-922亿亿</td>
</tr>
<tr>
<td>REAL（FLOAT(24)）</td>
<td>浮点型</td>
<td>4字节浮点数，范围约+/-1038</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>浮点型</td>
<td>8字节浮点数，范围约+/-10308</td>
</tr>
<tr>
<td>DECIMAL(M,N)</td>
<td>高精度小数</td>
<td>由用户指定精度的小数，例如，DECIMAL(20,10)表示一共20位，其中小数10位，通常用于财务计算</td>
</tr>
<tr>
<td>CHAR(N)</td>
<td>定长字符串</td>
<td>存储指定长度的字符串，例如，CHAR(100)总是存储100个字符的字符串</td>
</tr>
<tr>
<td>VARCHAR(N)</td>
<td>变长字符串</td>
<td>存储可变长度的字符串，例如，VARCHAR(100)可以存储0~100个字符的字符串</td>
</tr>
<tr>
<td>BOOLEAN</td>
<td>布尔类型</td>
<td>存储True或者False</td>
</tr>
<tr>
<td>DATE</td>
<td>日期类型</td>
<td>存储日期，例如，2018-06-22</td>
</tr>
<tr>
<td>TIME</td>
<td>时间类型</td>
<td>存储时间，例如，12:20:59</td>
</tr>
<tr>
<td>DATETIME</td>
<td>日期和时间类型</td>
<td>存储日期+时间，例如，2018-06-22 12:20:59</td>
</tr>
</tbody>
</table>
<h2 id="SQL约束"><a href="#SQL约束" class="headerlink" title="SQL约束"></a>SQL约束</h2><p>是限制“表”上数据的强制规则，可以在创建表时规定（CREATE TABLE）也可在创建表之后规定（ALTER TABLE）。常见约束有：</p>
<ul>
<li>NOT NULL：非空约束，一般应该避免为NULL，这样可以简化查询条件和加快查询速度。结合DEFAULT使用。</li>
<li>DEFAULT：默认值</li>
<li>UNIQUE：唯一值</li>
<li>主键：唯一标识，不能重复，不能为空。设置原则是：不使用任何业务相关的字段作为主键。一般使用“自增整数类型”或“全局唯一GUID类型”。</li>
<li>联合主键：多个字段唯一标识数据，除非必要否则应避免使用，因为它会使关系表的复杂度上升。多个字段中不能有为NULL的值，否则唯一约束失效（即使其他值相同也不会引起唯一性冲突）。</li>
<li>外键：唯一标识其他表数据（注意并不是通过列名实现的）。因为外键约束会降低数据库性能，所有很多公司并不设置外键，而是依靠应用程序自身逻辑。（数据量大或追求性能）</li>
<li>CHECK：列中所有数据满足某一条件</li>
<li>索引：快速检索，效率取决于索引列的值是否散列，即如果越互不相关则效率越高。提高了查询效率但是降低了插入、更新、删除的效率。</li>
</ul>
<h3 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h3><p>外键的作用是将数据的一致性、完整性交由数据库自身保证，最大限度的保证数据的一致性、完整性。如一张表的非主键字段指向另一张表的主键字段，则称该字段为该表的一个外键，该表为子表。另一张表为父表。</p>
<p>外键的默认作用有两点：</p>
<ul>
<li>对子表(外键所在的表)的作用：子表在进行写操作的时候，如果外键字段在父表中找不到对应的匹配，操作就会失败。</li>
<li>对父表的作用：对父表的主键字段进行删和改时，如果对应的主键在子表中被引用，操作就会失败。</li>
</ul>
<p>三种关系：</p>
<ul>
<li>一对一：一个表的记录对应到另一个表的唯一一个记录。主要作用是拆分表数据，提高数据库性能。</li>
<li><p>一对多：父表中的一个对应从表中的多个。</p>
</li>
<li><p>多对多：实际上是通过两个一对多关系实现的，即通过一个中间表，关联两个一对多关系。</p>
</li>
</ul>
<p>三种约束模式：</p>
<ul>
<li>district：严格模式(默认), 父表不能删除或更新一个被子表引用的记录。(同 no action)</li>
<li>cascade：级联模式, 父表操作后，子表关联的数据也跟着一起操作。</li>
<li>set null：置空模式,前提外键字段允许为NLL, 父表操作后，子表对应的字段被置空。</li>
</ul>
<p>“on delete”、 “on update” 、“on insert” 说的都是在父表中执行某种操作时，子表的约束模式。</p>
<ul>
<li>on delete<ul>
<li>district: 父表删除时，如果子表存在则无法删除。</li>
<li>cascade: 父表删除时，子表也一起删除。</li>
<li>set null: 父表删除时，指表被设置为 NULL。</li>
</ul>
</li>
<li>on updata<ul>
<li>district:父表（主键）更新时，如子表中存在则无法更新。</li>
<li>cascade:父表（主键）更新时，子表会被一起更新。</li>
<li>set null:父表（主键）更新时，子表被设置为NULL。</li>
</ul>
</li>
<li>on insert:</li>
<li>父表可正常增加，无论何种模式。</li>
<li>子表新增时外键值必须在主表中存在。</li>
</ul>
<h1 id="SQL语法"><a href="#SQL语法" class="headerlink" title="SQL语法"></a>SQL语法</h1><h2 id="SQL-的执行方式"><a href="#SQL-的执行方式" class="headerlink" title="SQL 的执行方式"></a>SQL 的执行方式</h2><h3 id="Oracle-中SQL的执行过程"><a href="#Oracle-中SQL的执行过程" class="headerlink" title="Oracle 中SQL的执行过程"></a>Oracle 中SQL的执行过程</h3><ol>
<li>语法检查：检查拼写是否正确。</li>
<li>语义检查：对象是否存在。</li>
<li>权限检查：是否具有操作权限。</li>
<li>共享池检查<ul>
<li>共享池是用来缓存SQL语句和该语句具体执行计划的。</li>
<li>有缓存，则直接调取执行计划。（软解析）</li>
<li>无缓存，则需要创建解析树进行解析，并生成执行计划，再进入“优化器”进行优化。（硬解析）</li>
</ul>
</li>
<li>“执行器”执行”执行计划“。</li>
</ol>
<p><strong><em>避免硬解析可以提高执行效率，比如使用绑定变量。</em></strong></p>
<h3 id="MySQL-中SQL的执行过程"><a href="#MySQL-中SQL的执行过程" class="headerlink" title="MySQL 中SQL的执行过程"></a>MySQL 中SQL的执行过程</h3><p>首先 MySQL 是C/S架构，其基本架构是：客户端 –&gt; 连接层 –&gt; SQL层 –&gt; 存储引擎层。</p>
<p>其最主要的特点是存储引擎采用插件式。常见引擎有如下：</p>
<ul>
<li>InnoDB：是5.5版以后的默认引擎，特点是支持事务、行级锁定、外键约束。</li>
<li>MyISAM：5.5版之前默认引擎，不支持事务和外键。但是速度快和占用资源少。</li>
<li>Memory：使用内存作存储介质，响应速度快。但是如果服务进程崩溃，会导致数据丢失。</li>
<li>NDB：也叫 NDB Cluster 存储引擎。主要用于分布式集群环境。</li>
<li>Archive：具有压缩机制。</li>
</ul>
<p><strong><em>MySQL中每张表可以选择使用不同的存储引擎。</em></strong></p>
<p>其SQL执行过程如下：</p>
<ul>
<li>查询缓存：8.0版本以后抛弃该环节。</li>
<li>解析器：语法、语言解析。</li>
<li>优化器：确定SQL执行路径。</li>
<li>执行器：检查权限并执行SQL。</li>
</ul>
<p>分析SQL语句的执行效率（时间）：</p>
<ul>
<li>开启 <code>PROFILING</code><ul>
<li><code>SELECT @@PROFILING;</code>：查看当前状态，0为关闭，1为开启。</li>
<li><code>SET PROFILING=1;</code>：设置状态。</li>
</ul>
</li>
<li>执行SQL</li>
<li>查看执行过程中所需资源<ul>
<li><code>SHOW PROFILES;</code>: 当前会话所产生的所有PROFILE。</li>
<li><code>SHOW PROFILE FOR QUERY &lt;query_id&gt;</code>: 查看指定查询的PROFILE。</li>
<li><code>SHOW PROFILE;</code>: 查看上一次查询的PROFILE。</li>
</ul>
</li>
</ul>
<h2 id="变量（MySQL为例）"><a href="#变量（MySQL为例）" class="headerlink" title="变量（MySQL为例）"></a>变量（MySQL为例）</h2><h3 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h3><ul>
<li>来源于软件自编译、配置文件中、以及启动参数中指定的变量。</li>
<li>只能修改（部分，重启失效）不能定义。但是需要<code>SUPER</code>权限。</li>
<li>作用于全局。</li>
</ul>
<p>查询：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SHOW GLOBAL VARIABLES;</span><br><span class="line">SHOW GLOBAL VARIABLES LIKE &apos;%sql%&apos;;</span><br><span class="line"></span><br><span class="line">SELECT @@GLOBAL.&lt;var&gt;;</span><br><span class="line">SELECT @@&lt;var&gt;;  # 该变量不能存在于会话变量</span><br></pre></td></tr></table></figure></p>
<p>修改：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SET GLOBAL &lt;var&gt;=&apos;&apos;;</span><br><span class="line">SET @@GLOBAL.&lt;var&gt;=&apos;&apos;;</span><br></pre></td></tr></table></figure></p>
<p><strong><em>详细的变量介绍可查看<a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html" target="_blank" rel="noopener">MySQL官方文档</a>。</em></strong></p>
<h3 id="会话变量"><a href="#会话变量" class="headerlink" title="会话变量"></a>会话变量</h3><ul>
<li>来自于全局变量的复制(部分)</li>
<li>只能修改不能定义。不需要<code>SUPER</code>权限。</li>
<li>作用于当前连接，连接断开变量消失。</li>
</ul>
<p>查询变量：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SHOW SESSION VARIABLES;</span><br><span class="line">SHOW SESSION VARIABLES LIKE &apos;%sql%&apos;;</span><br><span class="line"></span><br><span class="line">SELECT @@SESSION.&lt;var&gt;;</span><br><span class="line">SELECT @@LOCAL.&lt;var&gt;;</span><br><span class="line">SELECT @@&lt;var&gt;;</span><br></pre></td></tr></table></figure></p>
<p>赋值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SET SESSION &lt;var&gt; = &apos;&apos;;</span><br><span class="line">SET LOCAL &lt;var&gt; = &apos;&apos;;</span><br><span class="line">SET @@SESSION.&lt;var&gt; = &apos;&apos;;</span><br><span class="line">SET @@LOCAL.&lt;var&gt; = &apos;&apos;;</span><br><span class="line"></span><br><span class="line">SET @@&lt;var&gt; = &apos;&apos;;</span><br><span class="line">SET &lt;var&gt; = &apos;&apos;;</span><br></pre></td></tr></table></figure></p>
<p><strong><em>使用”@@“访问变量时，优先从会话变量中查找，会话变量中没有的才会到全局变量中查找。</em></strong></p>
<h3 id="用户变量"><a href="#用户变量" class="headerlink" title="用户变量"></a>用户变量</h3><ul>
<li>是用户自定义的变量。</li>
<li>无需声明，直接赋值即可。</li>
<li>作用于当前连接，连接断开变量消失。</li>
</ul>
<p>查询：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT @&lt;var&gt;;</span><br></pre></td></tr></table></figure></p>
<p>设置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SET @&lt;var&gt;=1;</span><br><span class="line">SET @&lt;var&gt;:=0;  # &quot;:=&quot;</span><br><span class="line">SELECT @&lt;var&gt;:=0; # 只能使用”:=“</span><br><span class="line"></span><br><span class="line">SELECT count(*) INTO @&lt;var&gt; FROM &lt;table_name&gt; WHERE ...;  # SELECT INTO</span><br></pre></td></tr></table></figure></p>
<p><strong><em><a href="https://dev.mysql.com/doc/refman/8.0/en/user-variables.html" target="_blank" rel="noopener">官方文档说明在这里</a>.</em></strong></p>
<h3 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h3><ul>
<li>是用户自定义的变量。</li>
<li>定义于函数或存储过程中，需要先声明再赋值。</li>
<li>只作用于函数或存储过程中，执行完毕即消失。</li>
</ul>
<p>如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE `p_name`()</span><br><span class="line">BEGIN</span><br><span class="line">    DECLARE i INT;  -- 声明变量</span><br><span class="line">    SET i = 1;  -- 赋值变量</span><br><span class="line">    </span><br><span class="line">    DECLARE m INT;</span><br><span class="line">    SELECT count(*) INTO @m FROM &lt;table_name&gt;;  -- 使用”SELECT INTO“赋值</span><br><span class="line">    ...    </span><br><span class="line">END</span><br></pre></td></tr></table></figure></p>
<h2 id="数据定义语言（DDL）"><a href="#数据定义语言（DDL）" class="headerlink" title="数据定义语言（DDL）"></a>数据定义语言（DDL）</h2><h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE &lt;database_name&gt;；</span><br><span class="line">DROP DATABASE &lt;database_name&gt;；</span><br></pre></td></tr></table></figure>
<h3 id="数据表"><a href="#数据表" class="headerlink" title="数据表"></a>数据表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &lt;table_name&gt; (&lt;field1&gt; &lt;data_type1&gt; 约束, &lt;field2&gt; &lt;data_type2&gt; 约束,...);</span><br><span class="line">DROP TABLE &lt;table_name&gt;;</span><br><span class="line">TRUNCATE TABLE &lt;table_name&gt;;  # 清空表中数据</span><br><span class="line">ALTER TABLE &lt;table_name&gt; ADD &lt;column_name&gt; &lt;data_type&gt;;  # 添加新字段</span><br><span class="line">ALTER TABLE &lt;table_name&gt; DROP COLUMN &lt;column_name&gt;;  # 删除字段</span><br><span class="line">ALTER TABLE &lt;table_name&gt; ALTER COLUMN &lt;column_name&gt; &lt;data_type&gt;;  # 修改数据类型</span><br><span class="line">ALTER TABLE &lt;table_name&gt; ALTER COLUMN &lt;column_name&gt; TO &lt;new_column_name&gt;;  # 修改数据类型</span><br></pre></td></tr></table></figure>
<h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE VIEW &lt;view_name&gt; AS SELECT &lt;field1&gt;, &lt;field2&gt; FROM &lt;table_name&gt; [WHERE ...];</span><br><span class="line">ALTER VIEW &lt;view_name&gt; AS SELECT &lt;field1&gt;, &lt;field2&gt; FROM &lt;table_name&gt; [WHERE ...]; # 同创建语法</span><br><span class="line">DROP VIEW view_name;</span><br></pre></td></tr></table></figure>
<ul>
<li>视图是虚拟表，并不真实存在，但是可以像真实表一样使用。实际上就是在<code>SELECT</code>语句的基础上的封装。</li>
<li>视图可以嵌套。</li>
<li>SQLite 不支持视图的修改，只支持创建和删除。</li>
<li>一般DBMS不支持创建索引，但SQL Server支持。</li>
</ul>
<p>作用：</p>
<ul>
<li>屏蔽了底层数据结构，提高了数据的安全性。</li>
<li>简化SQL查询语句，提高了代码的复用率，同时也提高了执行效率（视图的SQL语句只会在创建时编译一次）。</li>
</ul>
<p><strong><em>和临时表不同，视图不存储数据，而临时表是真实存在的表（但是只对应当前会话可见，会话结束后自动释放）。</em></strong></p>
<h2 id="数据操作语言（DML）"><a href="#数据操作语言（DML）" class="headerlink" title="数据操作语言（DML）"></a>数据操作语言（DML）</h2><h3 id="创建数据"><a href="#创建数据" class="headerlink" title="创建数据"></a>创建数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO &lt;table_name&gt; (&lt;field1&gt;, &lt;field2&gt;) VALUES (&lt;value1&gt;, &lt;value2&gt;);</span><br></pre></td></tr></table></figure>
<ul>
<li>字段顺序要和值顺序一一对应。</li>
<li>多条数据可用逗号隔开。</li>
</ul>
<h3 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE &lt;table_name&gt; SET &lt;field1&gt;=&lt;value1&gt;, &lt;field2&gt;=&lt;value2&gt; [WHERE ...];</span><br></pre></td></tr></table></figure>
<ul>
<li>会修改结果集中的 <strong>所有</strong> 数据。</li>
</ul>
<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM &lt;table_name&gt; [WHERE ...];</span><br></pre></td></tr></table></figure>
<ul>
<li>会删除结果集中的 <strong>所有</strong> 数据。</li>
</ul>
<h2 id="数据查询语言（DQL）"><a href="#数据查询语言（DQL）" class="headerlink" title="数据查询语言（DQL）"></a>数据查询语言（DQL）</h2><h3 id="简单查询"><a href="#简单查询" class="headerlink" title="简单查询"></a>简单查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &lt;table_name&gt;;  # “*”表示所有字段</span><br><span class="line">SELECT &lt;field1&gt;, &lt;field2&gt; FROM &lt;table_name&gt;;  # 查询指定字段</span><br><span class="line">SELECT &lt;filed&gt; AS f_alias FROM &lt;table_name&gt; AS t_alias;  # 重命名</span><br><span class="line">SELECT &lt;field1&gt;, &lt;field2&gt;, &apos;constant&apos; AS &lt;field_name&gt; FROM &lt;table_name&gt;;  # 设置常数列，常量需要使用引号。</span><br></pre></td></tr></table></figure>
<ul>
<li>SELECT 后不一定都有 FROM，如<code>SELECT 100+200;</code>可以用来计算，但这并不是SQL的强项。但是可以用其判断当前数据库的连接是否有效<br>（<code>SELECT 1;</code>）。</li>
</ul>
<h3 id="去重"><a href="#去重" class="headerlink" title="去重"></a>去重</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT &lt;field&gt;, &lt;field&gt;  FROM &lt;table_name&gt;</span><br></pre></td></tr></table></figure>
<h3 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &lt;table_name&gt; WHERE &lt;field1&gt; = &apos;value1&apos; AND &lt;field2&gt; = &apos;value2&apos;;</span><br></pre></td></tr></table></figure>
<ul>
<li>支持表达式：&gt;,&lt;,=,&gt;=,&lt;=,&lt;&gt;,IN, LIKE(模式匹配),BETWEEN(某个范围内)。</li>
<li>通配符只能和“LIKE”运算符一起使用，统配符有：<ul>
<li>“%”：匹配任意个任意字符。Access中使用“*”。</li>
<li>“_”：匹配一个字符，Access中使用“？”，DB2中不支持。</li>
<li><code>[charlist]</code>: 匹配字符列表中的单一字符。</li>
<li><code>[!charlist]</code>或<code>[^charlist]</code>:不匹配字符列表中的单一字符。</li>
</ul>
</li>
<li>多条件可使用 AND、OR 和 NOT，并可结合圆括号（“()”）组合使用。</li>
<li>特殊值“NULL”可用“IS NULL”和“IS NOT NULL”判断。</li>
</ul>
<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &lt;table_name&gt; ORDER BY &lt;field&gt; ASC;</span><br></pre></td></tr></table></figure>
<ul>
<li>多字段排序用逗号隔开。</li>
<li>支持升序（ASC）和降序（DESC）。默认为ASC，可省略。</li>
</ul>
<h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &lt;table_name&gt; LIMIT &lt;M&gt; OFFSET &lt;N&gt;;</span><br></pre></td></tr></table></figure>
<ul>
<li>LIMIT: 限制每一页的数量。</li>
<li>OFFSET：偏移量，从第几条数据开始。可以省略，相当于“OFFSET 0”</li>
<li>OFFSET 超过结果集最大数量时，返回为空。</li>
<li>OFFSET 越大效率越低。</li>
</ul>
<p><strong><em>MySQL、PostgreSQL、SQLite 中使用“LIMIT”，其他数据库略有不同，如SQL Server 和 Access 中使用“TOP”关键字，Oracle 使用“ROWNUM”关键字。</em></strong></p>
<p><strong><em>约束结果数据可以减少网络传输量，同时也可以提高查询效率。如约束只返回一条结果，则不需要扫描所有数据，而是查到一条即可返回结果。</em></strong></p>
<h3 id="聚类查询"><a href="#聚类查询" class="headerlink" title="聚类查询"></a>聚类查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*) FROM &lt;table_name&gt;;  # 计数结果数量</span><br></pre></td></tr></table></figure>
<p>除了<code>COUNT</code>函数外还有以下函数可使用：</p>
<ul>
<li>SUM：求和，必须是数值型。</li>
<li>AVG：平均值，必须是数值型。</li>
<li>MAX：最大值。</li>
<li>MIN：最小值。</li>
</ul>
<p><strong><em>注意：如果聚合查询的WHERE条件没有匹配到任何行，COUNT()会返回0，而SUM()、AVG()、MAX()和MIN()会返回NULL。</em></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT COUNT(*), &lt;filed1&gt; FROM &lt;table_name&gt; GROUP BY &lt;field1&gt;;</span><br></pre></td></tr></table></figure>
<ul>
<li>结果集中只能有分类字段（field1）和聚类结果（COUNT）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SECLECT SUM(&lt;field&gt;) AS sm FROM &lt;table_name&gt; HAVING sm &gt; 5;</span><br></pre></td></tr></table></figure>
<ul>
<li>过滤分组。</li>
<li>HAVING 和 WHERE 的作用是一样的。不同的是WHERE作用于数据行，HAVING则作用于分组。</li>
</ul>
<h3 id="连表查询"><a href="#连表查询" class="headerlink" title="连表查询"></a>连表查询</h3><p>SQL92和SQL99标准中连表查询语法略有不同，一般SQL92更简单但是可读性查，SQL99的可读性更强。现DBMS对SQL99标准支持度更好些，但是也略有不同。多表连接时更推荐SQL99的写法。</p>
<h4 id="笛卡尔查询"><a href="#笛卡尔查询" class="headerlink" title="笛卡尔查询"></a>笛卡尔查询</h4><p>查询结果是两张表的“乘积”，即用表1中的每一条数据都和表2的所有数据拼接一次。</p>
<p>SQL92<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &lt;table_a&gt;, &lt;table_b&gt;;</span><br></pre></td></tr></table></figure></p>
<p>SQL99<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &lt;table_a&gt; CROSS JOIN &lt;table_b&gt;;</span><br></pre></td></tr></table></figure></p>
<h4 id="等值连接和非等值连接"><a href="#等值连接和非等值连接" class="headerlink" title="等值连接和非等值连接"></a>等值连接和非等值连接</h4><p>使用“=”连接的叫等值连接，其他都叫非等值连接。<br>SQL92<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &lt;table_a&gt;, &lt;table_b&gt; WHERE &lt;table_a.field&gt; = &lt;table_b.field&gt;;</span><br></pre></td></tr></table></figure></p>
<p>SQL99<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &lt;table_a&gt;, &lt;table_b&gt; WHERE &lt;table_a&gt; NATURAL JOIN &lt;table_b&gt;;  # 自动查询相同字段并进行等值连接</span><br><span class="line">SELECT * FROM &lt;table_a&gt;, &lt;table_b&gt; WHERE &lt;table_a&gt; JOIN &lt;table_b&gt; USING (&lt;field&gt;);  # USING连接，需要指定同名字段</span><br><span class="line">SELECT * FROM &lt;table_a&gt; [INNER] JOIN &lt;table_b&gt; ON &lt;table_a.field&gt; = &lt;table_b.field&gt;;  # ON连接</span><br></pre></td></tr></table></figure></p>
<h4 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h4><p>SQL92中用“+”表示从表，且没有全连接。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &lt;table_name1&gt;  RIGHT [OUTER] JOIN &lt;table_name2&gt; ON &lt;table_name1.field&gt; = &lt;table_name2.field&gt;;</span><br></pre></td></tr></table></figure></p>
<p>连接方式有：</p>
<ul>
<li>RIGHT [OUTER] JOIN：右外连接，右表所有数据。</li>
<li>LEFT [OUTER] JOIN：左外连接，左表所有数据。</li>
<li>FULL [OUTER] JOIN：全连接，两张表所有数据。</li>
</ul>
<h4 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h4><p>查询条件使用当前表字段<br>SQL92<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &lt;table_a&gt; AS a, &lt;table_a&gt; AS b WHERE &lt;a.field&gt; &gt; &lt;b.field&gt;;</span><br></pre></td></tr></table></figure></p>
<p>SQL99<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &lt;table_a&gt; AS a JOIN &lt;table_a&gt; AS b ON &lt;a.field&gt; &gt; &lt;b.field&gt;;</span><br></pre></td></tr></table></figure></p>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><h5 id="不同DBMS中的差异"><a href="#不同DBMS中的差异" class="headerlink" title="不同DBMS中的差异"></a>不同DBMS中的差异</h5><ul>
<li>不是所有的 DBMS 都支持全外连接，如：MySQL、Access、SQLite。</li>
<li>Oracle 没有表别名 AS，而是直接写在后面。</li>
<li>SQLite 的外连接只有左连接</li>
</ul>
<h5 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h5><ul>
<li>控制连接表数量。</li>
<li>连接时使用WHERE语句。</li>
<li>使用自连接而不是子查询。 </li>
</ul>
<h3 id="SELECT-的执行顺序"><a href="#SELECT-的执行顺序" class="headerlink" title="SELECT 的执行顺序"></a>SELECT 的执行顺序</h3><p>首先关键字的顺序不能颠倒：<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT ... FROM ... WHERE ... GROUP BY ... HAVING ... ORDER BY ...</span><br></pre></td></tr></table></figure></p>
<p>执行顺序：<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FROM &gt; WHERE &gt; GROUP BY &gt; HAVING &gt; SELECT的字段 &gt; DISTINCT &gt; ORDER BY &gt; LIMIT</span><br></pre></td></tr></table></figure></p>
<p>如：<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT player_id, player_name, count(*) as num #顺序5</span><br><span class="line">FROM player JOIN team ON player.team_id = team.team_id #顺序1</span><br><span class="line">WHERE height &gt; 1.80 #顺序2</span><br><span class="line">GROUP BY player.team_id #顺序3</span><br><span class="line">HAVING num &gt; 2 #顺序4</span><br><span class="line">ORDER BY num DESC #顺序6</span><br><span class="line">LIMIT 2 #顺序7</span><br></pre></td></tr></table></figure></p>
<p> 每一个步骤都会创建一个“虚表”，然后用这个虚表的结果作为下一步的输入。</p>
<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 非关联子查询，子查询只执行一次</span><br><span class="line">SELECT &lt;field&gt;,... FROM &lt;table_a&gt; WHERE &lt;field&gt; = (SELECT MAX(&lt;field&gt;) FROM &lt;table_b&gt;)  </span><br><span class="line"></span><br><span class="line"># 关联子查询，子查询需要执行多次</span><br><span class="line">SELECT &lt;field&gt;,... FROM &lt;table_a&gt; AS a WHERE &lt;field&gt; &gt; (SELECT AVG(&lt;field&gt;) FROM &lt;filed_b&gt; AS b WHERE a.&lt;field1&gt; = b.&lt;field1&gt;)</span><br></pre></td></tr></table></figure>
<h4 id="集合比较子查询"><a href="#集合比较子查询" class="headerlink" title="集合比较子查询"></a>集合比较子查询</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &lt;table_a&gt; WHERE &lt;field&gt; IN (SELECT &lt;field&gt; FROM &lt;table_b&gt; [WHERE ...])</span><br><span class="line"></span><br><span class="line">SELECT * FROM &lt;table_a&gt; WHERE &lt;field&gt; &gt; ANY (SELECT &lt;field&gt; FROM &lt;table_b&gt; [WHERE ...])</span><br><span class="line">SELECT * FROM &lt;table_a&gt; WHERE &lt;field&gt; &gt; SOME (SELECT &lt;field&gt; FROM &lt;table_b&gt; [WHERE ...])  # 同ANY</span><br><span class="line"></span><br><span class="line">SELECT * FROM &lt;table_a&gt; WHERE &lt;field&gt; &gt; ALL (SELECT &lt;field&gt; FROM &lt;table_b&gt; [WHERE ...]</span><br></pre></td></tr></table></figure>
<ul>
<li>ANY 和 ALL 必须和比较符一起使用。</li>
</ul>
<h5 id="IN-amp-EXIST"><a href="#IN-amp-EXIST" class="headerlink" title="IN &amp; EXIST"></a>IN &amp; EXIST</h5><p>下面两个查询语句的结果是一样的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM A WHERE cc IN (SELECT cc FROM B)</span><br><span class="line">SELECT * FROM A WHERE EXISTS (SELECT cc FROM B WHERE B.cc=A.cc)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>结果是一样的，区别是执行的效率不同。</li>
<li>如果A表小于B表，则用EXISTS效率会高些。</li>
</ul>
<h4 id="子查询作为计算字段"><a href="#子查询作为计算字段" class="headerlink" title="子查询作为计算字段"></a>子查询作为计算字段</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT team_name, (SELECT count(*) FROM player WHERE player.team_id = team.team_id) AS player_num FROM team</span><br></pre></td></tr></table></figure>
<h3 id="合并结果集"><a href="#合并结果集" class="headerlink" title="合并结果集"></a>合并结果集</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM &lt;table_name1&gt;</span><br><span class="line">UNION </span><br><span class="line">SELECT * FROM &lt;table_name2&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>合并多个查询结果集，每个结果集必须拥有相同数量的列，且对应列要具有相似的数据类型。</li>
<li>合并后的结果集的列名，等于第一个结果集的列名。</li>
<li><code>UNION</code> 默认会去重，不去重可以使用<code>UNION ALL</code>.</li>
</ul>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>SQL中内置函数一般可分为：</p>
<ol>
<li>算术函数<ul>
<li>ABS(): 取绝对值。</li>
<li>MOD(): 取余数。</li>
<li>ROUND(): 四舍五入。</li>
</ul>
</li>
<li>字符串函数<ul>
<li>CONCAT(): 拼接字符串。</li>
<li>LENGTH(): 计算字符串长度，一个汉字算三个字符。</li>
<li>CHAR_LENGTH(): 计算字符串长度，一个汉字算一个字符。</li>
<li>LOWER(): 转小写。</li>
<li>UPPER()：转大写。</li>
<li>REPLACE(): 替换函数。</li>
<li>SUBSTRING(): 截取字符串。</li>
</ul>
</li>
<li>日期函数<ul>
<li>CURRENT_DATE():系统当前日期。</li>
<li>CIRRENT_TIME():系统当前时间，没有具体日期。</li>
<li>CURRENT_TIMESTAMP():系统当前时间，日期+时间。</li>
<li>EXTRACT():提取具体的年月日。</li>
<li>DATE():返回时间日期部分。</li>
<li>YEAR():返回时间年份部分。</li>
<li>MONTH():返回时间月份部分。</li>
<li>DAY():返回时间天数部分。</li>
<li>HOUR():返回时间小时部分。</li>
<li>MINUTE():返回时间分钟部分。</li>
<li>SECOND():返回时间秒部分。</li>
</ul>
</li>
<li>转换函数<ul>
<li>CAST(): 转换数据类型。如:CAST(123.123 AS DECIMAL(8,2))</li>
<li>COALESCE(): 返回第一个非NILL值。如：COALESCE(null,1,2)，运行结果为 1。</li>
</ul>
</li>
<li>聚合函数<ul>
<li>COUNT():总行数。</li>
<li>MAX():最大值。</li>
<li>MIN():最小值。</li>
<li>SUM():求和。</li>
<li>AVG():平均值。</li>
</ul>
</li>
</ol>
<p><strong><em>函数部分在不同DBMS中支持不同，而且各有扩展。所有可以移植性比较差，使用过程中需要格外注意。</em></strong></p>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>事务就将任意条SQL语句作为一个整体进行操作，要么成功，要么失败并还原成原状态。具有以下特点：</p>
<ul>
<li>原子性（Atomic）：将所有SQL作为原子工作单元执行，要么全部执行，要么全部不执行。</li>
<li>一致性（Consistent）：就是数据库在进行事务操作后，会由原来的一致状态，变成另一种一致的状态。也就是说当事务提交后，或者当事务发生回滚后，数据库的完整性约束不能被破坏。</li>
<li>隔离性（Isolation）：如果有多个事务并发执行，每个事务作出的修改必须与其他事务隔离。</li>
<li>持久性（Duration）：即事务完成后，对数据库数据的修改被持久化存储，即使系统崩溃。（通过日志完成）</li>
</ul>
<p><strong><em>Oracle是默认支持事务的，而MySQL中要使用合适的存储引擎（InnoDB）。</em></strong></p>
<h3 id="控制语句"><a href="#控制语句" class="headerlink" title="控制语句"></a>控制语句</h3><ul>
<li><code>START TRANSACTION</code> 或 <code>BEGIN</code>: 显示开启事务。</li>
<li><code>COMMIT</code>：提交事务，当提交事务后，对数据库的修改是永久性的。</li>
<li><code>ROLLBACK</code> 或者 <code>ROLLBACK TO [SAVEPOINT]</code>: 回滚事务。撤销正在进行的所有没有提交的修改，或者将事务回滚到某个保存点。</li>
<li><code>SAVEPOINT</code>：创建保存点，一个事务中可以存在多个保存点。</li>
<li><code>RELEASE SAVEPOINT</code>：删除某个保存点。</li>
<li><code>SET TRANSACTION</code>: 设置事务的隔离级别。</li>
</ul>
<h3 id="隐式事务-amp-显式事务"><a href="#隐式事务-amp-显式事务" class="headerlink" title="隐式事务&amp;显式事务"></a>隐式事务&amp;显式事务</h3><p>隐式事务实际上就是自动提交，Oracle 默认不自动提交，需要手写 COMMIT 命令，而 MySQL 默认自动提交（配置自动提交：<code>SET AUTOCOMMIT=1;</code>）。</p>
<p>自动提交模式下，每执行一条SQL语句都会自动COMMIT，也就是说每一条SQL语句都是独立事务。</p>
<p>非自动提交模式下，开启一个事务需要显示的开启，并需要手动COMMIT。</p>
<p>在MySQL中还需要考虑 <code>completion_type</code>的配置项。</p>
<ul>
<li>completion=0，这是默认情况。也就是说当我们执行 COMMIT 的时候会提交事务，在执行下一个事务时，还需要我们使用 START TRANSACTION 或者 BEGIN 来开启。</li>
<li>completion=1，这种情况下，当我们提交事务后，相当于执行了 COMMIT AND CHAIN，也就是开启一个链式事务，即当我们提交事务之后会开启一个相同隔离级别的事务。</li>
<li>completion=2，这种情况下 COMMIT=COMMIT AND RELEASE，也就是当我们提交后，会自动与服务器断开连接。</li>
</ul>
<h3 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h3><p>隔离性是为了防止数据库在并发处理时出现数据不一致的情况。在最严格的情况下，我们可以采用串行的方式，这样同一时刻只会有一个事务在执行，也就不会出现数据不一致的情况，当然也就没有并发了。在实际生产环境中，为了提高数据库的吞吐能力，往往需要牺牲掉一定的正确性来换取。</p>
<p>在SQL92标准中，定义了数据库在并发状态下出现的3种异常，以及4种隔离级别来处理该异常。关系如下：</p>
<table>
<thead>
<tr>
<th></th>
<th>隔离级别\异常</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody>
<tr>
<td>读未提交</td>
<td>允许</td>
<td>允许</td>
<td>允许</td>
</tr>
<tr>
<td>读已提交</td>
<td>禁止</td>
<td>允许</td>
<td>允许</td>
</tr>
<tr>
<td>可重复读</td>
<td>禁止</td>
<td>禁止</td>
<td>允许</td>
</tr>
<tr>
<td>可串行化</td>
<td>禁止</td>
<td>禁止</td>
<td>禁止</td>
</tr>
</tbody>
</table>
<p>3种异常：</p>
<ul>
<li>脏读（Dirty Read）：在一个事务内，读到另一个事务更新后但未提交的数据。如果另一个事务回滚，那么当前事务读到的数据就是脏数据。（一次读取）</li>
<li>不可重复读（Nnrepeatable Read）：在一个事务内，多次读同一数据，在这个事务还没有结束时，如果另一个事务恰好更新了该数据。导致多次读取结果不一致。（多次读取）</li>
<li>幻读（Phantom Read）：在一个事务内，更新某数据时，也有其他事务在更新该数据。导致更新后的结果并不是预想的值，产生”幻觉“。（一次更新，多次读取）</li>
</ul>
<p>4种隔离级别：</p>
<ul>
<li>读未提交（READ UNCOMMITTED）：允许读到未提交的数据，这种情况下查询是不会使用锁的，可能会产生脏读、不可重复读、幻读等情况。</li>
<li>读已提交（READ COMMITTED）：只能读到已经提交的内容，可以避免脏读的产生，属于 RDBMS 中常见的默认隔离级别（比如说 Oracle 和 SQL Server），但如果想要避免不可重复读或者幻读，就需要我们在 SQL 查询的时候编写带加锁的 SQL 语句</li>
<li>可重复读（REPEATABLE READ）：保证一个事务在相同查询条件下两次查询得到的数据结果是一致的，可以避免不可重复读和脏读，但无法避免幻读。MySQL 默认的隔离级别就是可重复读。</li>
<li>可串行化（SERIALIZABLE）：将事务进行串行化，也就是在一个队列中按照顺序执行，可串行化是最高级别的隔离等级，可以解决事务读取中所有可能出现的异常情况，但是它牺牲了系统的并发性。</li>
</ul>
<h2 id="存储过程（Stored-Procedure）"><a href="#存储过程（Stored-Procedure）" class="headerlink" title="存储过程（Stored Procedure）"></a>存储过程（Stored Procedure）</h2><p>存储过程和视图类似，都是对SQL语句的封装。但是其有不同于视图，存储过程可以直接操作底层数据结构，能够实现更加复杂的数据处理。</p>
<p>存储过程可以有输入，也可以返回输出。由SQL语句和流控制语句组成。</p>
<p>创建存储过程的格式如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE 存储过程名称([参数列表])</span><br><span class="line">BEGIN</span><br><span class="line">    需要执行的语句</span><br><span class="line">END</span><br></pre></td></tr></table></figure></p>
<p>如定义一个名为“add_num”的累加器：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-- DELIMITER //</span><br><span class="line">CREATE PROCEDURE `add_num`(IN n INT)</span><br><span class="line">BEGIN</span><br><span class="line">       DECLARE i INT;</span><br><span class="line">       DECLARE sum INT;</span><br><span class="line">       </span><br><span class="line">       SET i = 1;</span><br><span class="line">       SET sum = 0;</span><br><span class="line">       WHILE i &lt;= n DO</span><br><span class="line">              SET sum = sum + i;</span><br><span class="line">              SET i = i +1;</span><br><span class="line">       END WHILE;</span><br><span class="line">       SELECT sum;</span><br><span class="line">END</span><br><span class="line">-- END //</span><br><span class="line">-- DELIMITER ;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>因为SQL的默认结束符为“;”，为防止上面语句块中的“;”破坏整体性，需要在开始处定义新的结束符，最后再改回默认结束符。(当使用Navicat等管理工具时会自动完成该工作。)</li>
<li>注释用“–”。</li>
</ul>
<p>其他命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CALL add_num(50);  # 调用</span><br><span class="line">DROP PROCEDURE add_num;  # 删除</span><br><span class="line">ALTER PROCEDURE ....  # 修改</span><br><span class="line"></span><br><span class="line">SHOW PROCEDURE STATUS;  # 查看当前数据的所有存储过程</span><br><span class="line">SHOW PROCEDURE STATUS WHERE db = &lt;db_name&gt;;  # 查看指定数据的所有存储过程</span><br><span class="line">SHOW CREATE PROCEDURE &lt;procedure_name&gt;;  # 参考详情</span><br></pre></td></tr></table></figure></p>
<h3 id="参数类型"><a href="#参数类型" class="headerlink" title="参数类型"></a>参数类型</h3><ul>
<li>IN：输入参数。可用于存储过程中计算使用，但不能被返回。</li>
<li>OUT：输出参数。用于将存放计算结果，不能参与计算，但可以被返回。</li>
<li>INOUT：是IN和OUT的集合。既可以输入也可以输出。</li>
</ul>
<p>如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE `get_hero_scores`(</span><br><span class="line">       OUT max_max_hp FLOAT,</span><br><span class="line">       OUT min_max_mp FLOAT,</span><br><span class="line">       OUT avg_max_attack FLOAT,  </span><br><span class="line">       s VARCHAR(255)  # 默认为 IN 型</span><br><span class="line">       )</span><br><span class="line">BEGIN</span><br><span class="line">       SELECT MAX(hp_max), MIN(mp_max), AVG(attack_max) FROM heros WHERE role_main = s INTO max_max_hp, min_max_mp, avg_max_attack;  # 计算结果并赋值给输出变量</span><br><span class="line">END</span><br></pre></td></tr></table></figure></p>
<p>使用如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CALL get_hero_scores(@max_max_hp, @min_max_mp, @avg_max_attack, &apos;战士&apos;);</span><br><span class="line">SELECT @max_max_hp, @min_max_mp, @avg_max_attack;</span><br></pre></td></tr></table></figure></p>
<h3 id="流控制语句"><a href="#流控制语句" class="headerlink" title="流控制语句"></a>流控制语句</h3><ul>
<li>BEGIN…END: 中间可以包含多个语句，并且每个语句都以“;”为结束符。</li>
<li>DECLARE：变量声明，需要在<code>BEGIN...END</code>中并在其他语句之前。</li>
<li>SET: 变量赋值。</li>
<li>SELECT…INTO: 变量赋值，将计算结果放到输出变量中。</li>
<li>IF…THEN…[ELSE…ELSEIF…]ENDIF: 条件判断语句。</li>
<li>CASE WHEN…THEN…[ELSE…]END: 分支判断。</li>
<li>LOOP、LEAVE、ITERATE：分别是：循环、结束循环、跳过本次循环。类似python中<code>for</code>、<code>break</code>、<code>continue</code>。</li>
<li>REPEAT…UNTIL…END:首先会执行一次循环，然后在 UNTIL 中进行表达式的判断，如果满足条件就退出，即 END REPEAT；如果条件不满足，则会就继续执行循环，直到满足退出条件为止。</li>
<li>WHILE…DO…END WHILE：这也是循环语句，和 REPEAT 循环不同的是，这个语句需要先进行条件判断，如果满足条件就进行循环，如果不满足条件就退出循环。</li>
</ul>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><p>优点：</p>
<ul>
<li>一次编译多次使用，提高执行效率。</li>
<li>可以重复使用，减少工作量。</li>
<li>安全性高，网络传输量小。</li>
</ul>
<p>缺点：</p>
<ul>
<li>可移植性查，不同DBMS支持不同，需要重新编写。</li>
<li>调试困难，只有少数DBMS支持调试功能。增加了开发和维护成本。</li>
<li>不适用高并发场景。高并发的场景需要减少数据库的压力，有时数据库会采用分库分表的方式，而且对可扩展性要求很高，在这种情况下，存储过程会变得难以维护，增加数据库的压力，显然就不适用了。</li>
</ul>
<p><strong><em>存储过程的特点就是“优点明显、缺点突出”，实际使用中还是要结合实际情况。</em></strong></p>
<h2 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h2><p>一般我们在编写SQL语句时，大多是面向集合（结果集）的操作。游标则是数据库提供的一种更加灵活的数据操作方式，允许我们面向过程操作数据。首先使用游标时，系统会为用户在内存中设置缓存区，用来存放结果集。然后我们可以通过移动游标的方式，来定位结果集中的任意数据，从而实现面向过程的操作。游标一般在复杂的存储过程中会使用。使用游标有如下几个步骤：</p>
<ul>
<li><p>定义游标</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DECLARE &lt;cursor_name&gt; CURSOR FOR SELECT ....;</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开游标</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPEN &lt;cursor_name&gt;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FETCH &lt;cursor_name&gt; INTO &lt;var&gt;, &lt;var&gt; ...;  # 获取当前行数据，并将列数据存入对应变量中。游标自动移到下一行。</span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭游标</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CLOSE &lt;cursor_name&gt;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>释放游标</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEALLOCATE &lt;cursor_name&gt;;  # 如果不释放，则会一直在内存中，直至连接断开。</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong><em>不同DBMS语法略有不同，这样以MySQL为例。</em></strong></p>
<p>下面是一个简单的例子，定义了一个<code>wishing_you_prosperity</code>存储过程，并根据<code>programmer</code>表中的<code>age</code>值修改<code>wealth</code>值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">CREATE PROCEDURE `wishing_you_prosperity`()</span><br><span class="line">BEGIN</span><br><span class="line">    -- 创建接收游标的变量</span><br><span class="line">    DECLARE temp_id INT;  </span><br><span class="line">    DECLARE temp_age INT;</span><br><span class="line">    DECLARE temp_wealth INT; </span><br><span class="line">    DECLARE prosperity INT; </span><br><span class="line"></span><br><span class="line">    -- 创建结束标志变量  </span><br><span class="line">    DECLARE done INT DEFAULT false;</span><br><span class="line">       </span><br><span class="line">    -- 定义游标     </span><br><span class="line">    DECLARE cur_programmer CURSOR FOR SELECT id, age, wealth FROM programmer;</span><br><span class="line">    -- 定义”NOT FOUND“异常，用来判断循环结束  </span><br><span class="line">    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true;  </span><br><span class="line">       </span><br><span class="line">    OPEN cur_programmer;  </span><br><span class="line">    -- 循环读取数据</span><br><span class="line">    FETCH cur_programmer INTO temp_id, temp_age, temp_wealth;</span><br><span class="line">    REPEAT</span><br><span class="line">        IF NOT done THEN</span><br><span class="line">            IF temp_age &lt;= 30 THEN</span><br><span class="line">                SET prosperity = temp_wealth + 1000000;</span><br><span class="line">            ELSEIF temp_age &gt; 30 AND temp_age &lt;= 35 THEN</span><br><span class="line">                SET prosperity = temp_wealth + 1500000;</span><br><span class="line">            ELSEIF temp_age &gt; 35 AND temp_age &lt;= 45 THEN</span><br><span class="line">                SET prosperity = temp_wealth + 2500000;</span><br><span class="line">            ELSE </span><br><span class="line">                SET prosperity = temp_wealth * 2;</span><br><span class="line">            END IF;</span><br><span class="line">            -- 更新数据</span><br><span class="line">            UPDATE programmer SET wealth = prosperity WHERE id = temp_id;</span><br><span class="line">        END IF;</span><br><span class="line">    FETCH cur_programmer INTO temp_id, temp_age, temp_wealth;</span><br><span class="line">    UNTIL done = true END REPEAT;  -- 判断退出条件</span><br><span class="line">       </span><br><span class="line">    CLOSE cur_programmer;</span><br><span class="line">    -- Navicat 中不需要</span><br><span class="line">    -- DEALLOCATE cur_programmer；</span><br><span class="line">END</span><br></pre></td></tr></table></figure></p>
<h2 id="实用SQL语句"><a href="#实用SQL语句" class="headerlink" title="实用SQL语句"></a>实用SQL语句</h2><ul>
<li><p>插入数据，如果已存在就先删除再插入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REPLACE INTO students (id, class_id, name, gender, score) VALUES (1, 1, &apos;小明&apos;, &apos;F&apos;, 99);</span><br></pre></td></tr></table></figure>
</li>
<li><p>插入数据，如果已存在就更新数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO students (id, class_id, name, gender, score) VALUES (1, 1, &apos;小明&apos;, &apos;F&apos;, 99) ON DUPLICATE KEY UPDATE name=&apos;小明&apos;, gender=&apos;F&apos;, score=99;</span><br></pre></td></tr></table></figure>
</li>
<li><p>插入数据，如果已存在则跳过，什么也不做</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT IGNORE INTO students (id, class_id, name, gender, score) VALUES (1, 1, &apos;小明&apos;, &apos;F&apos;, 99);</span><br></pre></td></tr></table></figure>
</li>
<li><p>将结果集保存到新的数据表中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE students_of_class1 SELECT * FROM students WHERE class_id=1;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将结果集添加到已有的数据表中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO statistics (class_id, average) SELECT class_id, AVG(score) FROM students GROUP BY class_id;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="https://www.liaoxuefeng.com/wiki/1177760294764384" target="_blank" rel="noopener">廖雪峰老师的SQL教程</a></li>
<li>极客时间-SQL必知必会（陈旸）</li>
<li><a href="https://blog.csdn.net/albertsh/article/details/103421646" target="_blank" rel="noopener">MySQL中全局变量、会话变量、用户变量和局部变量的区别</a></li>
</ul>

      
    </div>

    

    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>csniu</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://csniu.github.io/2020/03/06/SQL-基础篇/" title="SQL-基础篇">https://csniu.github.io/2020/03/06/SQL-基础篇/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/03/03/python-redis/" rel="next" title="python-redis">
                <i class="fa fa-chevron-left"></i> python-redis
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/my_avatar.jpg" alt="csniu">
            
              <p class="site-author-name" itemprop="name">csniu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">17</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/csniu" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:csniulv@aliyun.com" target="_blank" title="E-Mail" rel="external nofollow"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前置知识"><span class="nav-number">1.</span> <span class="nav-text">前置知识</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#关系数据库"><span class="nav-number">2.</span> <span class="nav-text">关系数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#主流关系数据库"><span class="nav-number">2.1.</span> <span class="nav-text">主流关系数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据类型"><span class="nav-number">2.2.</span> <span class="nav-text">数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL约束"><span class="nav-number">2.3.</span> <span class="nav-text">SQL约束</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#外键"><span class="nav-number">2.3.1.</span> <span class="nav-text">外键</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL语法"><span class="nav-number">3.</span> <span class="nav-text">SQL语法</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL-的执行方式"><span class="nav-number">3.1.</span> <span class="nav-text">SQL 的执行方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Oracle-中SQL的执行过程"><span class="nav-number">3.1.1.</span> <span class="nav-text">Oracle 中SQL的执行过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL-中SQL的执行过程"><span class="nav-number">3.1.2.</span> <span class="nav-text">MySQL 中SQL的执行过程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#变量（MySQL为例）"><span class="nav-number">3.2.</span> <span class="nav-text">变量（MySQL为例）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#全局变量"><span class="nav-number">3.2.1.</span> <span class="nav-text">全局变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#会话变量"><span class="nav-number">3.2.2.</span> <span class="nav-text">会话变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用户变量"><span class="nav-number">3.2.3.</span> <span class="nav-text">用户变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#局部变量"><span class="nav-number">3.2.4.</span> <span class="nav-text">局部变量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据定义语言（DDL）"><span class="nav-number">3.3.</span> <span class="nav-text">数据定义语言（DDL）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库"><span class="nav-number">3.3.1.</span> <span class="nav-text">数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据表"><span class="nav-number">3.3.2.</span> <span class="nav-text">数据表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#视图"><span class="nav-number">3.3.3.</span> <span class="nav-text">视图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据操作语言（DML）"><span class="nav-number">3.4.</span> <span class="nav-text">数据操作语言（DML）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建数据"><span class="nav-number">3.4.1.</span> <span class="nav-text">创建数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改数据"><span class="nav-number">3.4.2.</span> <span class="nav-text">修改数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除数据"><span class="nav-number">3.4.3.</span> <span class="nav-text">删除数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据查询语言（DQL）"><span class="nav-number">3.5.</span> <span class="nav-text">数据查询语言（DQL）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#简单查询"><span class="nav-number">3.5.1.</span> <span class="nav-text">简单查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#去重"><span class="nav-number">3.5.2.</span> <span class="nav-text">去重</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#条件查询"><span class="nav-number">3.5.3.</span> <span class="nav-text">条件查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#排序"><span class="nav-number">3.5.4.</span> <span class="nav-text">排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分页"><span class="nav-number">3.5.5.</span> <span class="nav-text">分页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#聚类查询"><span class="nav-number">3.5.6.</span> <span class="nav-text">聚类查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#连表查询"><span class="nav-number">3.5.7.</span> <span class="nav-text">连表查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#笛卡尔查询"><span class="nav-number">3.5.7.1.</span> <span class="nav-text">笛卡尔查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#等值连接和非等值连接"><span class="nav-number">3.5.7.2.</span> <span class="nav-text">等值连接和非等值连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#外连接"><span class="nav-number">3.5.7.3.</span> <span class="nav-text">外连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自连接"><span class="nav-number">3.5.7.4.</span> <span class="nav-text">自连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#注意"><span class="nav-number">3.5.7.5.</span> <span class="nav-text">注意</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#不同DBMS中的差异"><span class="nav-number">3.5.7.5.1.</span> <span class="nav-text">不同DBMS中的差异</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#性能"><span class="nav-number">3.5.7.5.2.</span> <span class="nav-text">性能</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SELECT-的执行顺序"><span class="nav-number">3.5.8.</span> <span class="nav-text">SELECT 的执行顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子查询"><span class="nav-number">3.5.9.</span> <span class="nav-text">子查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#集合比较子查询"><span class="nav-number">3.5.9.1.</span> <span class="nav-text">集合比较子查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#IN-amp-EXIST"><span class="nav-number">3.5.9.1.1.</span> <span class="nav-text">IN &amp; EXIST</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#子查询作为计算字段"><span class="nav-number">3.5.9.2.</span> <span class="nav-text">子查询作为计算字段</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#合并结果集"><span class="nav-number">3.5.10.</span> <span class="nav-text">合并结果集</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#函数"><span class="nav-number">3.6.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#事务"><span class="nav-number">3.7.</span> <span class="nav-text">事务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#控制语句"><span class="nav-number">3.7.1.</span> <span class="nav-text">控制语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#隐式事务-amp-显式事务"><span class="nav-number">3.7.2.</span> <span class="nav-text">隐式事务&amp;显式事务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#隔离级别"><span class="nav-number">3.7.3.</span> <span class="nav-text">隔离级别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储过程（Stored-Procedure）"><span class="nav-number">3.8.</span> <span class="nav-text">存储过程（Stored Procedure）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#参数类型"><span class="nav-number">3.8.1.</span> <span class="nav-text">参数类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#流控制语句"><span class="nav-number">3.8.2.</span> <span class="nav-text">流控制语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#特点"><span class="nav-number">3.8.3.</span> <span class="nav-text">特点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#游标"><span class="nav-number">3.9.</span> <span class="nav-text">游标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实用SQL语句"><span class="nav-number">3.10.</span> <span class="nav-text">实用SQL语句</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考"><span class="nav-number">4.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">csniu</span>

  

  
</div>


  



  <div class="powered-by">由 <a class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" rel="external nofollow" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a> v6.1.0</div>




        








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  











  



  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/reading_progress/reading_progress.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.1.0"></script>



  

  
    <script id="dsq-count-scr" src="https://csniu.disqus.com/count.js" async></script>
  

  
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'https://csniu.github.io/2020/03/06/SQL-基础篇/';
        this.page.identifier = '2020/03/06/SQL-基础篇/';
        this.page.title = 'SQL-基础篇';
      };
      function loadComments () {
        var d = document, s = d.createElement('script');
        s.src = 'https://csniu.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      }
      
        $(function () {
          var offsetTop = $('#comments').offset().top - $(window).height();
          if (offsetTop <= 0) {
            // load directly when there's no a scrollbar
            loadComments();
          } else {
            $(window).on('scroll.disqus_scroll', function () {
              var scrollTop = document.documentElement.scrollTop;
              if (scrollTop >= offsetTop) {
                $(window).off('.disqus_scroll');
                loadComments();
              }
            });
          }
        });
      
    </script>
  





	





  












  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  

  

  

  

  
  
  
  <script src="/lib/bookmark/bookmark.min.js?v=1.0"></script>
  <script type="text/javascript">
  
    bookmark.scrollToMark('auto', "#more");
  
  </script>


</body>
</html>
